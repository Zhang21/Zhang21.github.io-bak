<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Zabbix - 风继续吹</title><meta name="Description" content="个人博客"><meta property="og:title" content="Zabbix" />
<meta property="og:description" content="参考：

Zabbix官方网站
Zabbix中文文档
Zabbix-repo仓库: http://repo.zabbix.com
阿里云镜像: https://mirrors.aliyun.com/zabbix/zabbix/ .

环境：

CentOS7x86_64
Zabbix 3.4


" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhang21.cn/zabbix/" /><meta property="og:image" content="https://zhang21.cn/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-11-14T10:18:09&#43;00:00" />
<meta property="article:modified_time" content="2017-11-14T10:18:09&#43;00:00" /><meta property="og:site_name" content="My cool site" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://zhang21.cn/logo.png"/>

<meta name="twitter:title" content="Zabbix"/>
<meta name="twitter:description" content="参考：

Zabbix官方网站
Zabbix中文文档
Zabbix-repo仓库: http://repo.zabbix.com
阿里云镜像: https://mirrors.aliyun.com/zabbix/zabbix/ .

环境：

CentOS7x86_64
Zabbix 3.4


"/>
<meta name="application-name" content="风继续吹">
<meta name="apple-mobile-web-app-title" content="风继续吹"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://zhang21.cn/zabbix/" /><link rel="prev" href="https://zhang21.cn/git/" /><link rel="next" href="https://zhang21.cn/fhs/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Zabbix",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/zhang21.cn\/zabbix\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/zhang21.cn\/images\/Apple-Devices-Preview.png",
                            "width":  3200 ,
                            "height":  2048 
                        }],"genre": "posts","keywords": "zabbix","wordcount":  29687 ,
        "url": "https:\/\/zhang21.cn\/zabbix\/","datePublished": "2017-11-14T10:18:09+00:00","dateModified": "2017-11-14T10:18:09+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Zhang21","logo": "https:\/\/zhang21.cn\/leslie.png"},"author": {
                "@type": "Person",
                "name": "Zhang21"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="风继续吹"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>风继续吹</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="https://github.com/zhang21" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="风继续吹"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>风继续吹</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="https://github.com/zhang21" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Zabbix</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://zhang21.cn" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Zhang21</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/monitor/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>monitor</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2017-11-14">2017-11-14</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;约 29687 字&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;预计阅读 60 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#zabbix简介">Zabbix简介</a>
      <ul>
        <li><a href="#zabbix的系统构成">Zabbix的系统构成</a></li>
        <li><a href="#zabbix的特点">Zabbix的特点</a></li>
      </ul>
    </li>
    <li><a href="#定义">定义</a></li>
    <li><a href="#zabbix进程">Zabbix进程</a>
      <ul>
        <li><a href="#agent">Agent</a></li>
      </ul>
    </li>
    <li><a href="#安装zabbix">安装Zabbix</a>
      <ul>
        <li><a href="#zabbix安装要求">Zabbix安装要求</a>
          <ul>
            <li><a href="#配置源码库">配置源码库</a></li>
            <li><a href="#编辑zabbix的前端apach-php配置文件">编辑zabbix的前端Apach-PHP配置文件</a></li>
          </ul>
        </li>
        <li><a href="#安装zabbix-agent">安装zabbix agent</a></li>
        <li><a href="#新建触发器">新建触发器</a></li>
        <li><a href="#获取问题通知">获取问题通知</a></li>
        <li><a href="#新建模板">新建模板</a></li>
      </ul>
    </li>
    <li><a href="#配置configuration">配置(Configuration)</a>
      <ul>
        <li><a href="#主机和主机组hosts-and-groups">主机和主机组(Hosts and groups)</a>
          <ul>
            <li><a href="#配置一台主机">配置一台主机</a></li>
            <li><a href="#资产管理inventory">资产管理(Inventory)</a></li>
            <li><a href="#批量更新mass-update">批量更新(Mass update)</a></li>
          </ul>
        </li>
        <li><a href="#监控项items">监控项(Items)</a>
          <ul>
            <li><a href="#创建一个监控项">创建一个监控项</a></li>
            <li><a href="#监控项类型items-type">监控项类型(Items type)</a></li>
            <li><a href="#历史与趋势history-and-trends">历史与趋势(history and trends)</a></li>
            <li><a href="#用户自定义参数user-parameter">用户自定义参数(user parameter)</a></li>
            <li><a href="#option-userparameter">Option: UserParameter</a></li>
            <li><a href="#触发器依赖trigger-dependency">触发器依赖(trigger dependency)</a></li>
            <li><a href="#批量更新">批量更新</a></li>
            <li><a href="#触发器严重性trigger-severity">触发器严重性(trigger severity)</a></li>
            <li><a href="#自定义触发器严重性customising-trigger">自定义触发器严重性(customising trigger)</a></li>
            <li><a href="#预测触发功能predictive-trigger-function">预测触发功能(predictive trigger function)</a></li>
            <li><a href="#事件标签event-tag">事件标签(event tag)</a></li>
          </ul>
        </li>
        <li><a href="#事件events">事件(Events)</a>
          <ul>
            <li><a href="#触发器事件生成trigger-events-generation">触发器事件生成(trigger events generation)</a></li>
            <li><a href="#手动关闭问题事件manual-closing-of-problems">手动关闭问题事件(manual closing of problems)</a></li>
            <li><a href="#其他事件来源other-event-source">其他事件来源(other event source)</a></li>
          </ul>
        </li>
        <li><a href="#事件关联event-correlation">事件关联(event correlation)</a></li>
        <li><a href="#可视化visualisation">可视化(visualisation)</a>
          <ul>
            <li><a href="#图形graphs">图形(graphs)</a></li>
          </ul>
        </li>
        <li><a href="#事件通知notifications-upon-events">事件通知(notifications upon events)</a>
          <ul>
            <li><a href="#media类型">media类型</a>
              <ul>
                <li><a href="#条件condition">条件(condition)</a></li>
                <li><a href="#操作operation">操作(operation)</a>
                  <ul>
                    <li><a href="#发送消息">发送消息</a></li>
                    <li><a href="#远程命令">远程命令</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#宏macros">宏(macros)</a>
          <ul>
            <li><a href="#宏函数macro-function">宏函数(macro function)</a></li>
            <li><a href="#用户宏user-macro">用户宏(user macro)</a></li>
            <li><a href="#自动发现宏lld">自动发现宏(LLD)</a></li>
          </ul>
        </li>
        <li><a href="#用户和用户组user-and-group">用户和用户组(user and group)</a></li>
      </ul>
    </li>
    <li><a href="#服务监控service-monitoring">服务监控(service monitoring)</a></li>
    <li><a href="#web监控web-monitoring">Web监控(web monitoring)</a>
      <ul>
        <li><a href="#web监控项web-monitoring-items">Web监控项(web monitoring items)</a></li>
      </ul>
    </li>
    <li><a href="#虚拟机监控vm-monitoring">虚拟机监控(VM monitoring)</a></li>
    <li><a href="#维护maintenance">维护(maintenance)</a></li>
    <li><a href="#事件确认event-acknowledgment">事件确认(event acknowledgment)</a></li>
    <li><a href="#配置导出导入configuration-exportimport">配置导出/导入(Configuration export/import)</a></li>
    <li><a href="#将zabbix展现在nginx上">将Zabbix展现在Nginx上</a></li>
    <li><a href="#zabbix监控">Zabbix监控</a>
      <ul>
        <li><a href="#监控mysql">监控MySQL</a>
          <ul>
            <li><a href="#使用zabbix自带模板监控mysql">使用Zabbix自带模板监控MySQL</a></li>
            <li><a href="#使用percona插件监控mysql">使用Percona插件监控MySQL</a></li>
          </ul>
        </li>
        <li><a href="#监控mongodb">监控MongoDB</a>
          <ul>
            <li><a href="#监控一台主机上的额外mongod实例">监控一台主机上的额外mongod实例</a></li>
          </ul>
        </li>
        <li><a href="#监控php-fpm">监控PHP-FPM</a></li>
        <li><a href="#监控nginx">监控Nginx</a></li>
        <li><a href="#监控redis">监控Redis</a></li>
      </ul>
    </li>
    <li><a href="#系统监控">系统监控</a>
      <ul>
        <li><a href="#cpu">CPU</a>
          <ul>
            <li><a href="#tips">Tips</a></li>
          </ul>
        </li>
        <li><a href="#内存">内存</a>
          <ul>
            <li><a href="#自定义内存使用率">自定义内存使用率</a></li>
            <li><a href="#添加触发器">添加触发器</a></li>
          </ul>
        </li>
        <li><a href="#磁盘">磁盘</a></li>
        <li><a href="#进程和端口">进程和端口</a>
          <ul>
            <li><a href="#检测进程数">检测进程数</a></li>
            <li><a href="#端口">端口</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#用户自定义参数user-parameter-1">用户自定义参数(user parameter)</a>
      <ul>
        <li><a href="#jq">jq</a>
          <ul>
            <li><a href="#jq的select语句">jq的select语句</a></li>
          </ul>
        </li>
        <li><a href="#编写自定义参数和脚本">编写自定义参数和脚本</a>
          <ul>
            <li><a href="#编写脚本文件">编写脚本文件</a></li>
            <li><a href="#编写自定义参数文件">编写自定义参数文件</a></li>
            <li><a href="#测试自定义参数">测试自定义参数</a></li>
            <li><a href="#自定义用户参数额外">自定义用户参数额外</a></li>
            <li><a href="#在web端添加监控项">在Web端添加监控项</a></li>
            <li><a href="#设置触发器和报警">设置触发器和报警</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#短信报警">短信报警</a>
      <ul>
        <li><a href="#腾讯短信服务">腾讯短信服务</a></li>
        <li><a href="#配置">配置</a>
          <ul>
            <li><a href="#获取python-sdk">获取Python SDK</a></li>
            <li><a href="#申请sdk-appid和app-key">申请SDK AppID和App Key</a></li>
            <li><a href="#申请短信签名">申请短信签名</a></li>
            <li><a href="#申请短信模板">申请短信模板</a></li>
            <li><a href="#sdk配置">SDK配置</a></li>
            <li><a href="#python代码配置">Python代码配置</a></li>
          </ul>
        </li>
        <li><a href="#zabbix-web端配置">Zabbix Web端配置</a></li>
      </ul>
    </li>
    <li><a href="#针对不同业务向不同人员报警">针对不同业务向不同人员报警</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>参考：</p>
<ul>
<li><a href="https://www.zabbix.com/" target="_blank" rel="noopener noreffer ">Zabbix官方网站</a></li>
<li><a href="https://www.zabbix.com/documentation/3.4/zh/manual/" target="_blank" rel="noopener noreffer ">Zabbix中文文档</a></li>
<li>Zabbix-repo仓库: <a href="http://repo.zabbix.com">http://repo.zabbix.com</a></li>
<li>阿里云镜像: <a href="https://mirrors.aliyun.com/zabbix/zabbix/">https://mirrors.aliyun.com/zabbix/zabbix/</a> .</li>
</ul>
<p>环境：</p>
<ul>
<li>CentOS7x86_64</li>
<li>Zabbix 3.4</li>
</ul>
<br/>
<br/>
<hr>
<br/>
<h1 id="zabbix简介">Zabbix简介</h1>
<p>Zabbix （音同 zæbix），是由 Alexei Vladishev 开发的一种网络监视、管理系统，基于 Server-Client 架构。Zabbix 的授权是属于 GPLv2。
Zabbix可用于监视各种网络服务、服务器和网络机器等状态。是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。
Zabbix也可经由SNMP、TCP、ICMP、SSH等对目标进行监视。</p>
<br>
<h2 id="zabbix的系统构成">Zabbix的系统构成</h2>
<p>Zabbix系统由以下各独立模块组成：</p>
<ul>
<li>Zabbix Server，服务端(以C开发)。Server端通过收集SNMP和Agent发送的数据，写入数据库，再通过PHP+Apache在Web端展示；</li>
<li>Zabbix Agent，客户端(基本支持所有操作系统)，并将监控主机数据发送给Server；</li>
<li>Zabbix Frontend，Web管理端(以PHP和JavaScript构成)；</li>
<li>Zabbix Proxy(可选组件)。用于分布式监控。</li>
</ul>
<br/>
<h2 id="zabbix的特点">Zabbix的特点</h2>
<p>Zabbix是一个高度集成的网络监控解决方案，一个简单的安装包中提供多样性功能。</p>
<ul>
<li>数据收集；</li>
<li>灵活的阀值(触发器)定义；</li>
<li>高度可配置化的告警；</li>
<li>实现图表绘制；</li>
<li>Web监控功能；</li>
<li>丰富的可视化选项；</li>
<li>历史数据存储；</li>
<li>配置简单；</li>
<li>使用模板；</li>
<li>网络发现；</li>
<li>Zabbix API；</li>
<li>权限管理系统；</li>
<li>功能强大并易于扩展的监控代理。</li>
</ul>
<br>
<br/>
<hr>
<h1 id="定义">定义</h1>
<p>Zabbix的常用术语含义。</p>
<p><strong>主机(host)：</strong></p>
<p>一台你想监控的网络设备，用IP或域名表示。主机名不能使用中文创建，会报错。</p>
<p><strong>主机组(host group):</strong>
主机的逻辑组，它包含主机和模板。组名可以使用中文。</p>
<p><strong>监控项(item):</strong>
你想要接收的主机的特定数据，一个度量数据。</p>
<p><strong>触发器(trigger):</strong>
一个被用于定义问题阀值和评估监控项接收到的数据的逻辑表达式。</p>
<p><strong>事件(event):</strong>
单次发生的需要注意的事情。</p>
<p><strong>异常(problem):</strong>
一个处在异常状态的触发器。</p>
<p><strong>动作(action):</strong>
一个对事件作出反应的预定义的操作。</p>
<p><strong>升级(escalation):</strong>
一个在动作内执行操作的自定义场景。</p>
<p><strong>媒介(media):</strong>
发送报警通知的手段。</p>
<p><strong>通知(notification):</strong>
利用已选择的媒体途径把事情相关信息发送给用户。</p>
<p><strong>远程命令(remote command):</strong>
预先定义好的，满足一定条件后，可在被监控主机上自动执行的命令。</p>
<p><strong>模板(template):</strong>
一组可以被应用到一个或多个主机上的实体的集合。</p>
<p><strong>应用(application):</strong>
一组监控项组成的逻辑分组。</p>
<p><strong>Web场景(Web scenario):</strong>
利用一个或多个HTTP请求来检查网站的可用性。</p>
<p><strong>前端(frontend):</strong>
Zabbix提供的Web界面。</p>
<p><strong>Zabbix API:</strong>
Zabbix API允许你使用JSON RPC协议来创建、更新和获取Zabbix对象信息或执行任何其他的自定义的任务。</p>
<p><strong>Zabbix server:</strong>
Zabbix软件监控的核心程序，主要功能是与Zabbix proxies和agent进行交互、触发器计算、发送告警通知，并将数据集中保存等。</p>
<p><strong>Zabbix agent:</strong>
部署在监控对象上，能够主动监控本地资源和应用。</p>
<p><strong>Zabbix proxy:</strong>
帮助Zabbix server收集数据，分担Zabbix server的负载。</p>
<br>
<br/>
<hr>
<h1 id="zabbix进程">Zabbix进程</h1>
<h2 id="agent">Agent</h2>
<p>zabbix agent部署在监控的目标上，主动监测本地的资源和应用（硬件驱动，内存，处理器统计等）。
zabbix agent手机本地的操作信息并将数据报告给zabbix server用于进一步处理。</p>
<p>zabbix agent有被动(passive)和主动(active)两种检查方式。</p>
<br>
## Server
zabbix server是zabbix软件的核心程序。它通过轮询和捕获数据，计算是否满足触发器条件，向用户发送通知。
它是zabbix监控代理和Proxy代理报告系统可用性和完整性数据的核心组件。zabbix server自身可以通过简单远程检查网络服务(如Web服务器和邮件服务器)。
<p>server是一个包含了被存储了所有配置，统计方面的和可操作数据的中央仓库，它是监控系统问题升级以致于激活警告管理器的zabbix中的实体。</p>
<p>基本的zabbix server分三个不同的组件：<strong>zabbix server，web前端，数据库存储</strong>。
zabbix的所有配置信息都存储在服务器和web前端进行交互的数据库中。</p>
<p>zabbix server进程是以守护进程（Daemon）运行的。</p>
<br>
## Proxy
zabbix proxy是一个可以从一个或多个受监控的设备设备收集监控数据，并将信息发送到zabbix server的进程，基本上是代表server工作。
所有收集的数据都在本地进行缓存，然后传送到proxy所属的zabbix server。
<p>zabbix proxy是完成远程区域、分支机构、没有本地管理员的网络的集中监控的理想解决方案。</p>
<p>zabbix proxy需要使用独立的数据库，以守护进程的方式运行。</p>
<br>
## Java gateway
zabbix守护进程原生支持监控JMX程序，它被称为zabbix java gateway。zabbix gateway是用Java语言写成。
<p>要查得一台主机特定的JMX计数器值，zabbix server向zabbix java gateway发送请求，后者使用JMX管理API去请求远程的有关应用。应用不许额外安装软件，只需要启动时在命令行指定 <code>-Dcom.sun.management.jmxremote</code>即可（是在java程序）。</p>
<p>每个zabbix server或zabbix agent只能配置一个java gateway。</p>
<br/>
## Sender
zabbix sender是一种命令行应用，它可以将性能数据发送到zabbix server进行处理。该应用通常用在长时间运行的用户脚本，用于定期发送可用性和性能数据。
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">zabbix_sender -z zabbix -s &#34;xxx&#34; -k db.connections -0 43

-z :server主机
-s :受监控主机的技术名称
-k :监控项的键
-o :要发送的值
</code></pre></td></tr></table>
</div>
</div><br>
## Get
zabbix get也是一种命令行应用，用于与zabbix agent进行通信，并从agent那里获取所需的信息。
该应用通常被用于zabbix agent故障排除
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">zabbix_get -s $host -p xxx -k system.cpu.load[all,avg15]

-s  --host
-p --port
-I --source-address
-k --key
-h --help
-V --version
</code></pre></td></tr></table>
</div>
</div><br>
<br/>
<hr>
<h1 id="安装zabbix">安装Zabbix</h1>
<h2 id="zabbix安装要求">Zabbix安装要求</h2>
<p><strong>硬件：</strong></p>
<ul>
<li>内存，最小128MB；</li>
<li>磁盘，最小256MB；</li>
<li>CPU，可能需要大量CPU资源；</li>
<li>SMS(短信)通知服务，串行通讯口(serial communication port)和串口GSM调制解调器(serial GSM modem)。可选项。</li>
</ul>
<p><strong>支持平台：</strong></p>
<ul>
<li>Linux;</li>
<li>IBM AIX;</li>
<li>FreeBSD;</li>
<li>NetBSD;</li>
<li>OpenBSD;</li>
<li>Mac OS X;</li>
<li>Solaris;</li>
<li>Windows(Only Agent).</li>
</ul>
<p><strong>软件：</strong>
Zabbix基于Apache Web服务器、领先的数据库引擎和PHP脚本语言进行构建。</p>
<p><strong>数据库管理系统：</strong></p>
<ul>
<li>MySQL 5.0.3 及以上；</li>
<li>Oracle 10g 及以上；</li>
<li>PostgreSQL 8.1 及以上；</li>
<li>SQLite 3.5及以上；</li>
<li>IBM DB2 9.7 及以上。</li>
</ul>
<p><strong>前端：</strong></p>
<ul>
<li>Apache 1.3.12 及以上；</li>
<li>PHP 5.4.0及以上；</li>
</ul>
<p><strong>PHP-Extension:</strong></p>
<p>软件 | 版本 | 备注</p>
<ul>
<li>| - | -
gd | 2.0及以上 | PHP GD扩展包必须支持PNG图片
bcmatch |  | php-bcmatch
ctype |  | php-ctype
libXML | 2.6.15及以上 | php-xml
xmlreader |  | php-xmlreader
xmlwrite |  | php-xmlwriter
session |  | php-session
sockets |  | php-net-socket
mbstring |  | php-mbstring
gettext |  | php-gettext
ldap |  | php-ldap
mysqli |  | 使用MySQL作为Zabbix后端数据库所需的组件
pgsql |  | 使用PostgreSQL作为Zabbix后端数据库所需的组件
sqlite3 |  | 使用SQLite作为Zabbix后端数据库所需的组件</li>
</ul>
<p><strong>客户端浏览器：</strong>
必须启用Cookie和JavaScript功能。</p>
<p><strong>服务器：</strong></p>
<p>要求 | 描述 |</p>
<ul>
<li>| - |
OpenlPMI | 支持IPMI功能所需组件 |
libssh2 | 支持SSH功能 |
fping | 支持ICMP ping功能 |
libcurl | 支持Web监控，VMware监控及SMTP认证 |
libiksemel | 支持Jabber功能 |
libxml2 | 支持VMware监控 |
net-snmp | 支持SNMP监控 |</li>
</ul>
<p><strong>Java网关：</strong>
Java gateway编译和运行在Java 1.6 及以上版本。</p>
<p><strong>数据库容量：</strong>
Zabbix配置数据需要使用固定的磁盘空间，而这个空间不会过多增长。</p>
<p>Zabbix数据库容量主要依赖于以下参数：</p>
<ul>
<li>每秒处理值的数量(Number of processed values per second);</li>
<li>历史(History)数据的回收清理设置(Housekeeper);</li>
<li>趋势(Trends)数据的回收清理设置(Housekeeper);</li>
<li>事件(Events)数据的回收清理设置(Housekeeper)。</li>
</ul>
<p><strong>时钟同步：</strong>
对于Zabbix稳定运行而言，服务获取精确的系统时间是非常重要的。对于所有运行Zabbix组件的系统，强烈建议这些系统的时间保持同步。
<code>ntpd</code>是一个临幸的用于同步主机和其他服务器之间的时间的后台程序。</p>
<br>
## 安装、启动、配置Zabbix
Zabbix-repo仓库：[repo.zabbix.com](repo.zabbix.com)
该仓库服务器同时提供`yum`和`apt`源码库。
<h3 id="配置源码库">配置源码库</h3>
<p><strong>1. 从官方下载源码库</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1">#rpm -ivh http://repo.zabbix.com/zabbix/$version/rhel/7/$arch/$zabbix-release.rpm</span>
rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-1.el7.centos.noarch.rpm

<span class="c1">#阿里云镜像</span>
<span class="c1">#rpm -ivh http://mirrors.aliyun.com/zabbix/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-1.el7.noarch.rpm</span>

<span class="c1">#镜像失效的话自己去官网找</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>2. 手动配置zabbix.repo</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">vim /etc/yum.repos.d/zabbix.repo

<span class="o">[</span>zabbix<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>Zabbix-Repo
<span class="nv">baseurl</span><span class="o">=</span>http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">0</span>
<span class="nv">enable</span><span class="o">=</span><span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><br>
### 安装Zabbix部署包
<p>使用MySQL数据库安装Zabbix Server、Web前端：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">yum install -y zabbix-server-mysql zabbix-get
</code></pre></td></tr></table>
</div>
</div><p><strong>注意：此处Zabbix数据库使用MySQL，请自行安装MySQL。</strong></p>
<p>安装Zabbix Agent：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">yum install -y zabbix-agent
</code></pre></td></tr></table>
</div>
</div><br>
### 安装初始化数据库
<p>查看刚刚安装的 <strong>zabbix-server-mysql</strong>：
解压得到的sql脚本<code>create.sql</code>只会在对应的数据库中初始化zabbix所需要的数据库表，但是不会创建zabbix数据库。所以后面我们还需要手动创建<code>zabbix</code>数据库。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">rpm -ql zabbix-server-mysql

<span class="nb">cd</span> /usr/share/doc/zabbix-server-mysql-3.x.xx/

<span class="c1">#有一个create.sql.gz的压缩文件</span>
gunzip create.sql.gz
<span class="c1">#得到create.sql</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>在MySQL中创建zabbix数据库：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">msyql -uxxx -p

mysql&gt;CREATE DATABASE <span class="s1">&#39;zabbix&#39;</span> DEFAULT CHARACTER SET <span class="s1">&#39;utf8&#39;</span><span class="p">;</span>
mysql&gt;SHOW DATABASES<span class="p">;</span>
mysql&gt;GRANT ALL ON zabbix.* TO <span class="s1">&#39;zabbix&#39;</span>@<span class="s1">&#39;localhost&#39;</span> identified by <span class="s1">&#39;zabbix&#39;</span><span class="p">;</span>
mysql&gt;FLUSH PRIVILEGES<span class="p">;</span>

<span class="c1">#导入sql脚本</span>
mysql -uroot -p -Dzabbix &lt; ./create.sql

USE zabbix<span class="p">;</span>
SHOW TABLES<span class="p">;</span>


<span class="c1">#mysql限制IP</span>
vim /etc/my.cnf

<span class="o">[</span>mysqld<span class="o">]</span>
bind-address<span class="o">=</span>127.0.0.1
</code></pre></td></tr></table>
</div>
</div><br>
![zabbix-database alt="zabbix-database"](/images/zabbix_database.png)
<br/>
### 配置zabbix server并启动
<p>编辑zabbix server配置文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">vim /etc/zabbix/zabbix_server.conf

<span class="c1">#常会修改的参数</span>

<span class="c1">#数据库配置</span>
<span class="nv">DBHost</span><span class="o">=</span>localhost
<span class="nv">DBName</span><span class="o">=</span>zabbix
<span class="nv">DBUser</span><span class="o">=</span>zabbix
<span class="nv">DBPassword</span><span class="o">=</span>zabbix
<span class="nv">DBPort</span><span class="o">=</span><span class="m">3306</span>
<span class="nv">DBSocket</span><span class="o">=</span>/var/lib/mysql/mysql.sock

<span class="c1">#服务监听端口</span>
<span class="nv">ListenPort</span><span class="o">=</span><span class="m">10051</span>

<span class="c1">#服务端源IP</span>
<span class="nv">SourceIP</span><span class="o">=</span>

<span class="c1">#日志记录方式，file使用指定文件作为日志文件，system将日志发往syslog，console将日志发送控制台</span>
<span class="nv">LogType</span><span class="o">=</span>file
<span class="nv">LogFile</span><span class="o">=</span>/var/log/zabbix/zabbix_server.log
</code></pre></td></tr></table>
</div>
</div><p>启动zabbix服务端：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">systemctl start zabbix-server

<span class="c1">#此处可能由于没有关闭SELinux而报错</span>
tail /var/log/zabbix/zabbix_server.log
cannot <span class="nb">set</span> resource limit: <span class="o">[</span>13<span class="o">]</span> Permission denied

<span class="c1">#关闭SELinux</span>
<span class="nv">setenforce</span><span class="o">=</span><span class="m">0</span>

vim /etc/selinux/config
<span class="nv">SELINUX</span><span class="o">=</span>disabled

<span class="c1">#查看zabbix-server默认监听的10051端口</span>
netstat -nltp
</code></pre></td></tr></table>
</div>
</div><br>
### 安装zabbix web
zabbix web可以安装在单独的主机上，只要能连接到zabbix database所在数据库就行。但为了方便，都安装在了server上。
<p>zabbix web需要LAMP环境：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1">#可能需要自己配置PHP remi源，注意PHP及扩展版本问题</span>
yum install -y httpd php php-mysql php-mbstring php-gd php-bcmatch php-ldap php-xml

<span class="c1">#指定php版本</span>
<span class="c1">#yum --enablerepo=remi-php56 install php-mysql php-mbstring php-gd php-bcmatch php-ldap php-xml</span>

</code></pre></td></tr></table>
</div>
</div><p>安装zabbix web所需的两个包：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">yum install -y zabbix-web zabbix-web-mysql
<span class="c1">#此处默认使用php5.4</span>
<span class="c1">#因为我的环境是php5.6,会报错</span>
<span class="c1">#此时就需要指定php版本来安装</span>
yum --enablerepo<span class="o">=</span>remi-php56 install zabbix-web zabbix-web-mysql


rpm -ql zabbix-web
<span class="c1">#zabbix-web位于/usr/share/zabbix/</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="编辑zabbix的前端apach-php配置文件">编辑zabbix的前端Apach-PHP配置文件</h3>
<p>zabbix前端的Apache配置文件位于 /etc/httpd/conf.d/zabbix.conf:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">vim /etc/httpd/conf.d/zabbix.conf

<span class="c1">#需修改时区</span>
php_value max_execution_time <span class="m">300</span>
php_value memory_limit 128M
php_value post_max_size 16M
php_value upload_max_filesize 2M
php_value max_input_time <span class="m">300</span>
php_value always_populate_raw_post_data -1
php_value date.timezone Asia/Shanghai

<span class="c1">#建议顺便修改/etc/php.ini的时区</span>
vim /etc/php.ini

date.timezone <span class="o">=</span> Asia/Shanghai


<span class="c1">#添加httpd的虚拟主机访问zabbix web</span>
&lt;VirtualHost IP:80&gt;
servername zabbix.me
documentroot /usr/share/zabbix

默认数据

&lt;/VirtualHost&gt;


<span class="c1">#开启httpd服务</span>
systemctl start httpd
</code></pre></td></tr></table>
</div>
</div><br>
![/etc/httpd/conf.d/zabbix.conf](/images/Zabbix/zabbix_conf.png)
<br/>
添加hosts后就可以利用域名访问zabbix-web端了。
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">echo</span> -e <span class="s2">&#34;192.168.1.9 \t zabbix.me&#34;</span> &gt;&gt; /etc/hosts
</code></pre></td></tr></table>
</div>
</div><br>
### 在web端配置zabbix
<p>在浏览器访问 <a href="http://zabbix.me">http://zabbix.me</a> 初始化zabbix配置。
配置好后就需要用账号密码进行登录zabbix-web端dashboard。</p>
<p>默认用户名是：admin，密码是配置文件里面设置的。
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/zabbix_me.png"
        data-srcset="/images/Zabbix/zabbix_me.png, /images/Zabbix/zabbix_me.png 1.5x, /images/Zabbix/zabbix_me.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/zabbix_me.png"
        title="登录zabbix Dashboard" /></p>
<br>
<p>登录进Dashboard后，可修改语言为中文。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/dashboard.jpg"
        data-srcset="/images/Zabbix/dashboard.jpg, /images/Zabbix/dashboard.jpg 1.5x, /images/Zabbix/dashboard.jpg 2x"
        data-sizes="auto"
        alt="/images/Zabbix/dashboard.jpg"
        title="Dashboard" /></p>
<br>
<p><strong>如果你的Zabbix无法看到中文选项，那么可能需要如下操作：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">vim /usr/share/zabbix/include/locales.inc.php

<span class="c1">#修改</span>
<span class="s1">&#39;zh_CN&#39;</span> <span class="o">=</span>&gt; <span class="o">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=</span>&gt; _<span class="o">(</span><span class="s1">&#39;Chinese (zh_CN)&#39;</span><span class="o">)</span>,     <span class="s1">&#39;display&#39;</span> <span class="o">=</span>&gt; true<span class="o">]</span>,
</code></pre></td></tr></table>
</div>
</div><p><strong>如果又遇到中文乱码的问题，则可以从windows中挑选一些好看的中文字体，将对应字体文件放置到zabbix web的字体目录中。</strong>
windows中字体后缀.TTF，Linux中为.ttf。注意修改大小写。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">cd</span> /usr/share/zabbix/fonts
<span class="c1">#只有一个默认字体 graphfont.ttf</span>
<span class="c1">#将新字体放置到此目录下</span>


<span class="c1">#修改配置文件中对应字体名称</span>
vim /usr/share/zabbix/include/define.inc.php

<span class="c1">#将默认字体名字修改为字体目录下 你需要的字体名</span>
define<span class="o">(</span><span class="s1">&#39;ZBX_FONT_NAME&#39;</span>, <span class="s1">&#39;graphfont&#39;</span><span class="o">)</span><span class="p">;</span>
define<span class="o">(</span><span class="s1">&#39;ZBX_GRAPH_FONT_NAME&#39;</span>,           <span class="s1">&#39;graphfont&#39;</span><span class="o">)</span><span class="p">;</span> // font file name

<span class="c1">#栗子，如perpetua字图PER.ttf</span>
define<span class="o">(</span><span class="s1">&#39;ZBX_FONT_NAME&#39;</span>, <span class="s1">&#39;PER&#39;</span><span class="o">)</span><span class="p">;</span>
define<span class="o">(</span><span class="s1">&#39;ZBX_GRAPH_FONT_NAME&#39;</span>,           <span class="s1">&#39;PER&#39;</span><span class="o">)</span><span class="p">;</span> // font file name
</code></pre></td></tr></table>
</div>
</div><br>
<p><strong>图形显示乱码，同样是用以上方法。在windowss上找一个中文字体上传到zabbix字体目录，并修改配置文件就可以了。</strong></p>
<br>
<p>Zabbix Web界面菜单：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/zabbix_menu.png"
        data-srcset="/images/Zabbix/zabbix_menu.png, /images/Zabbix/zabbix_menu.png 1.5x, /images/Zabbix/zabbix_menu.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/zabbix_menu.png"
        title="zabbix菜单" /></p>
<br>
<ul>
<li>管理菜单，用于管理zabbix自身及zabbix相关设置；</li>
<li>配置菜单，用于配置监控相关设置；</li>
<li>报表菜单，为管理员生成一段时间内的监控统计信息；</li>
<li>检测中菜单，用于查看被监控的相关数据；</li>
<li>资产记录菜单，查看被监控的主机有哪些，以及相关的资产信息。</li>
</ul>
<br>
<h2 id="安装zabbix-agent">安装zabbix agent</h2>
<p>Agent端安装也非常方便，直接在Client上安装两个包即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">
<span class="c1">#配置zabbix源</span>
rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-1.el7.centos.noarch.rpm

<span class="c1">#aliyun镜像</span>
<span class="c1">#rpm -ivh http://mirrors.aliyun.com/zabbix/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-1.el7.noarch.rpm</span>

<span class="c1">#安装</span>
yum install -y zabbix-agent zabbix-sender

rpm -ql zabbix-agent
<span class="c1">#/etc/zabbix/zabbix_agentd.conf</span>
</code></pre></td></tr></table>
</div>
</div><p>zabbix的“主动模式”与“被动模式”都在<code>/etc/zabbix/zabbix_agentd.conf</code>中定义。
配置最常用的agent端：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">vim /etc/zabbix/zabbix_agentd.conf

<span class="c1">####GENERAL PARAMETERS 通用配置</span>
<span class="nv">PidFile</span><span class="o">=</span>
<span class="nv">LogFile</span><span class="o">=</span>


<span class="c1">####Passive checks related 被动模式配置</span>
<span class="c1">#指定允许哪台服务器拉取本机数据</span>
<span class="nv">Server</span><span class="o">=</span>
<span class="c1">#指定agent端工作于被动模式时监听的端口号</span>
<span class="nv">ListenPort</span><span class="o">=</span>10050<span class="o">(</span>默认<span class="o">)</span>
<span class="c1">#指定agent端工作与被动模式时所监听的IP地址</span>
<span class="nv">ListenIP</span><span class="o">=</span>0.0.0.0<span class="o">(</span>默认<span class="o">)</span>
<span class="c1">#指定预生成的agent进程数量</span>
<span class="nv">StartAgents</span><span class="o">=</span>


<span class="c1">####Active checks related</span>
<span class="c1">#agent工作于主动模式时，将消息推送到哪台Server上</span>
<span class="nv">ServerActive</span><span class="o">=</span>IP1,IP2...
<span class="c1">#指定当前主机主机名，Server端通过对应的主机名识别主机</span>
<span class="nv">Hostname</span><span class="o">=</span>
<span class="c1">#指明agent端每隔多少秒将采集的数据发往Server端</span>
<span class="nv">RefreshActiveChecks</span><span class="o">=</span>


<span class="c1">#栗子</span>
<span class="nv">Server</span><span class="o">=</span>192.168.1.9
<span class="nv">ServerActive</span><span class="o">=</span>192.168.1.9
<span class="nv">Hostname</span><span class="o">=</span>zabbix.me
</code></pre></td></tr></table>
</div>
</div><br>
**启动zabbix-agent**
```sh
systemctl zabbix-agent start
<p>#查看状态,默认端口10050
netstat -nltp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">
![zabbix-agent状态](/images/Zabbix/zabbix-agent.png)




&lt;br&gt;
&lt;br/&gt;

---

# 快速开始zabbix-web菜单

zabbix-web界面中包含有**监测中、资产记录、报表、配置、管理**五项菜单。


&lt;br&gt;


## 登录和配置用户

在浏览器输入 [zabbix.me](zabbix.me) (修改hosts)，登录zabbix-web后台。

默认用户名：**Admin**，密码：**zabbix**。它是超级管理员。

为了防止暴力破解和词典攻击，连续尝试五次登录失败，zabbix界面将暂停30秒。

&lt;br&gt;

可以通过**管理(Management)**菜单下的**用户(User)**，新建、查看、管理用户信息。

zabbix在安装后自定义了两个用户：
- Admin用户是zabbix的超级管理员，拥有所有权限；
- Guest用户是一个特殊的默认用户。如果你没有登录，你访问zabbix的时候其实就是“guest”权限。guest默认没有任何权限。

你可以创建一个用户(user)并将其加入特定的用户组(Group)以提升用户权限。
![新建用户](/images/Zabbix/user.png)

可以仅用用户信息里面-报警媒介里面，自定义严重性的报警。只有勾选部分的报警信息才会发送过来。这也很棒！

如果存在严重性则使用：

- [ ] Not classified
- [ ] Information
- [ ] Warning
- [ ] Average
- [ ] High
- [ ] Disaster

![Use if severity](/images/Zabbix/Useifseverity.png)


&lt;br/&gt;
&lt;br&gt;


## 新建主机

zabbix中的主机(host)是一个你想要监控的网络实体(物理的、虚拟的)。对于主机的定义非常灵活。它可以是一台物理服务器，一个网络交换机，一个虚拟机或一些应用。

&lt;br&gt;
可以通过**配置(Configuration)**菜单下的**主机(Host)**，查看已配置主机相关信息。
默认有一个“Zabbix Server”的定义好的主机。


点击**创建主机(Create host)**后，填写对应的主机名称、添加对应的主机群组，zabbix-agent的IP地址和端口，以及其它信息。

![创建主机](/images/Zabbix/host.png)



&lt;br&gt;
&lt;br&gt;


## 新建监控项

监控项是zabbix中获得数据的基础。没有监控项，就没有数据。因为一个主机中只有监控项定义了”单一的指标“或者”需要获得的数据“。

&lt;br&gt;
可以通过**配置(Configuration)**菜单下的**主机(Item)**，找到需要配置**监控项(Item)**的主机，然后创建监控项。
主机默认是没有定义任何监控项的。

填写对应的监控名称、类型、键值、主机接口、信息类型等等信息。
![添加监控项](/images/Zabbix/create-item.png)


&lt;br&gt;
可在**监控(Monitoring)**菜单中**最新数据(Latest data)**查看之前定义的监控项和获得的值。
还可选择以**图形(Graph)**或**值**来查看监控项的相关信息。
![upload监控信息](/images/Zabbix/upload.png)

同样也还以在Zabbix-Server端获得数据信息：
```sh
#zabbix_get -s $ip -k $value
zabbix_get -s 192.168.1.9 -k system.cpu.load
</code></pre></td></tr></table>
</div>
</div><br>
<br>
<h2 id="新建触发器">新建触发器</h2>
<p>监控项只用于收集数据。如果要自动评估收到的数据，我们则需要定义触发器(trigger)。
触发器包含了一个表达式，这个表达式定义了数据的可接受的阈值级别。</p>
<p>如果收到的数据超过了定义好的级别，触发器将被<strong>触发</strong>，或者进入<strong>异常状态</strong>(problem)。
从而引起我们的注意，让我们知道有问题发生。如果数据再次恢复到合理范围，触发器将会转到<strong>正常状态</strong>(OK)。</p>
<br>
<p>可以通过**配置(Configuration)<strong>菜单下的</strong>主机(Hosts)<strong>选项，找到某主机的</strong>触发器(Triggers)**创建触发器。</p>
<p>填写对应的触发器名称、表达式、描述等信息。
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/create-trigger.png"
        data-srcset="/images/Zabbix/create-trigger.png, /images/Zabbix/create-trigger.png 1.5x, /images/Zabbix/create-trigger.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/create-trigger.png"
        title="创建触发器" /></p>
<br>
<br>
<h2 id="获取问题通知">获取问题通知</h2>
<p>当监控项收集了数据后，触发器会根据异常状态触发报警。根据一些报警机制，它也会通知我们一些重要的事情，而不是直接在zabbix-web端进行查看。
这就是<strong>通知(Notification)<strong>的功能。
<strong>E-mail</strong>是最常用的异常通知发送方式。当然还有</strong>SMS（短信），脚本</strong>等媒体类型。</p>
<br>
<p>可以通过<strong>管理(Administration)<strong>菜单中的</strong>报警媒体类型(Media types)</strong>，点击预定义媒体类型列表中的Email，来配置Email。
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/create-email.png"
        data-srcset="/images/Zabbix/create-email.png, /images/Zabbix/create-email.png 1.5x, /images/Zabbix/create-email.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/create-email.png"
        title="创建Email通知" /></p>
<p>为了建立一个通知，我们需要在<strong>配置</strong>菜单下<strong>动作</strong>中，创建<strong>动作(Create action)</strong>。
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/create-action.png"
        data-srcset="/images/Zabbix/create-action.png, /images/Zabbix/create-action.png 1.5x, /images/Zabbix/create-action.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/create-action.png"
        title="创建动作" /></p>
<p>一旦满足了触发器的条件，变回触发执行动作。如收到E-mail等&hellip;</p>
<br/>
<br>
<h2 id="新建模板">新建模板</h2>
<p>如果我们配置上前台主机，一些自动化操作会带来更多便利性。没错，**模板(templates)**功能就可以实现。
模板允许对有用的监控项、触发器和其他对象进行分组，只需要一步就可以对监控主机应用模板，已达到反复重用的目的。</p>
<p>当一个模板链接到一个主机后，主机会继承这个模板中的所有对象。简单而言，一组预先定义好的检查会被快速应用到主机上。</p>
<p>Zabbix为各种操作系统、设备以及应用准备好了一些预定义的模板。你可以快速部署使用他们。
<strong>但是请注意，一些模板需要根据你的实际情况和使用环境进行适当俄调整。</strong> 比如，一些检查项是不需要的，一些轮询周期过于频繁等。</p>
<br/>
在**配置**菜单下的**模板(Templates)**下，点击**创建模板(Create template)**。填写对应的模板名称，群组等信息。
![创建模板](/images/Zabbix/create-template.png)
<p>创建模板完毕后，可将模板链接到主机。之后，模板及其所有对象被添加到了主机。</p>
<br>
<br>
<hr>
<h1 id="配置configuration">配置(Configuration)</h1>
<br>
<h2 id="主机和主机组hosts-and-groups">主机和主机组(Hosts and groups)</h2>
<p>一般来讲，zabbix主机是指你希望监控的那些设备。如服务器、工作站、交换机等。
创建主机是使用zabbix过程的首要任务。</p>
<p>我们可以把主机组想象成项目组。根据不同的功能将主机划分到主机组是非常重要的，这样可以对以后创建的用户和用户组在定义权限的时候，不用给他们zabbix admin权限，而只需要根据主机组(项目组)给予用户和用户组对应项目(主机组)的权限即可。
这样很大程度上方便了Zabbix监控多个项目，也利于管理。同样，报警的时候也只会收到权限内的相关报警信息。</p>
<br>
<h3 id="配置一台主机">配置一台主机</h3>
<p>配置&ndash;主机&ndash;创建主机&ndash;填写相关参数信息。</p>
<p>可以在已经存在的主机上使用 <strong>Clone</strong>或<strong>Full Clone</strong>创建一个新主机。</p>
<blockquote>
<p>Clone将保留所有的主机参数和模板链接；
Full Clone将额外保留指数实体(应用集、监控项、触发器、视图、规则、Web场景)。</p>
</blockquote>
<p><strong>新建主机下：</strong></p>
<ol>
<li>主机(Host)：包含了通用的主机属性；</li>
<li>模板(Template)：允许将模板链接诶到主机，所有实体将从模板继承；</li>
<li>IPMI：包含IPMI管理属性；</li>
<li>宏(Macros)：允许定义主机级别的<strong>用户宏</strong>；</li>
<li>主机资产记录(Host inventory)：允许为主机收工输入库存信息；</li>
<li>允许你请求与主机的加密的连接。</li>
</ol>
<br>
<h3 id="资产管理inventory">资产管理(Inventory)</h3>
<p>你可以将联网设备的资产信息保存在zabbix里。
资产信息实在配置主机时人工录入建立的资产信息数据，或者通过使用某些自动填充选项完成的录入。</p>
<p><strong>构建资产库：</strong></p>
<ul>
<li>手动模式： 在配置一台主机的时候，手动输入资产信息；</li>
<li>自动模式： 在配置主机的时候，选择自动。</li>
</ul>
<p>之后便可以在<strong>资产记录</strong>菜单中的<strong>概述，主机</strong>项中查看相关信息。</p>
<br/>
<h3 id="批量更新mass-update">批量更新(Mass update)</h3>
<p>有时候可能需要一次更改多个主机的某些属性，使用**批量更新(mass update)**功能来代替打开每个主机进行编辑。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/mass-update.png"
        data-srcset="/images/Zabbix/mass-update.png, /images/Zabbix/mass-update.png 1.5x, /images/Zabbix/mass-update.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/mass-update.png"
        title="批量更新" /></p>
<p>可批量处理<strong>主机、模板、IPMI、资产、加密</strong>相关信息。</p>
<br/>
<br>
<h2 id="监控项items">监控项(Items)</h2>
<p><strong>监控项</strong>是从主机收集的数据信息。
配置主机后，需要添加一些监控项以开始获取数据。快速添加多个监控项的一种方法是将预定义的模板附加到主机。</p>
<p>在单个监控项中，可指定从主机收集哪些数据信息。
为此，可使用<strong>监控项key</strong>。 如<strong>system.cpu.load</strong>将收集处理器负载的数据。
要给 key 指定更过参数，请在后面添加<strong>方括号[]</strong>。 如<strong>system.cpu.load[avg5]</strong>， 返回最近5分钟的CPU负载平均值。</p>
<br>
<h3 id="创建一个监控项">创建一个监控项</h3>
<p>可在主机中新建一个监控项。
不支持的监控项：如果由于某种原因无法检索该值，则该监控项可能不被支持。这些监控项仍然以固定的间隔重新检查。</p>
<p><strong>监控项的key:</strong></p>
<ol>
<li>key名称允许使用字符： 0-9a-zA-Z_-.</li>
<li>key参数，用 逗,号 分隔： xxx[par1,par2&hellip;]</li>
<li>key参数也可以为空，此时使用默认值： key</li>
<li>key参数带引号，则允许任何Unicode字符，如果包含双引号则需要 \反斜杠 转义</li>
<li>key参数是一个数组，它需要包含在方括号中</li>
</ol>
<br>
<p><strong>自定义间隔(Custom intervals)</strong></p>
<p>创建关于监控项的自定义时间规则。
灵活间隔被设计为重新定义默认监控项的的更新间隔，但调度间隔用于指定独立执行的检查计划。</p>
<p>**灵活的间隔(Flexible intervals)：**允许重定义特定时间段的默认间隔。</p>
<ul>
<li>间隔(Interval)： 指定时间段的更新间隔；</li>
<li>期间(Period)： 灵活间隔有效的时间段；</li>
<li>举个栗子： 60(interval), 1-7,00-24(period)。监控项每隔60s检查一次。</li>
</ul>
<br/>
<p>**调度间隔(Scheduling intervals)：**用于在特定时间检查监控项。</p>
<p>调度间隔定义为， <code>md&lt;filter&gt;wd&lt;filter&gt;h&lt;filter&gt;m&lt;filter&gt;s&lt;filter&gt;</code>。</p>
<ul>
<li>md: month days(1-31)</li>
<li>wd: week days(1-7)</li>
<li>h:  hours(0-23)</li>
<li>m:  minutes(0-59)</li>
<li>s:  seconds(0-58)</li>
<li><filter>: 指定其前缀的值&mdash;-[from-to/step]。</li>
</ul>
<p>其实类似于Linux中定时任务的写法，只不过这里把单位(md,wd,h,m,s)写在了数值的前面。</p>
<p>举个栗子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">md1-15	<span class="c1">#1-15号</span>

wd3	<span class="c1">#星期三</span>

h0-12	<span class="c1">#上半天</span>

m1,3,5,7,9	<span class="c1">#每个1,3,5,7,9分钟</span>

s/10	<span class="c1">#每个10s</span>

<span class="c1">#组合体</span>
wd1-5h9-18m/10	<span class="c1">#每个工作日的上班时间每个10分钟</span>
</code></pre></td></tr></table>
</div>
</div><br>
<h3 id="监控项类型items-type">监控项类型(Items type)</h3>
<p>监控项类型包含从系统获取数据的多种方式。每个监控项类型都有一组自己支持的监控项key和所需的参数。</p>
<p>zabbix提供的监控项类型：</p>
<ol>
<li>zabbix代理检查(agent checks)</li>
<li>SNMP代理检查</li>
<li>SNMP traps</li>
<li>IPMI检查</li>
<li>简单检查(simple checks)</li>
<li>VMware监控(monitoring)</li>
<li>日志文件监控</li>
<li>计算监控项(Calculated items)</li>
<li>zabbix内部检查(internal checks)</li>
<li>SSH检查</li>
<li>Telnet检查</li>
<li>外部检查(External checks)</li>
<li>汇总检查(Aggregate checks)</li>
<li>捕捉器监控项(Trapper items)</li>
<li>JMX监控</li>
<li>ODBC监控</li>
</ol>
<br>
<p><strong>zabbix代理(zabbix agent)：</strong>
这些检查与zabbix代理进行通信实现数据的采集。</p>
<ol>
<li>zabbix agent-passive： 被动模式，Server向Agent索要数据；</li>
<li>zabbix agent-active： 主动模式，Agent主动上报数据给Server。</li>
</ol>
<p>可支持的监控项，可在新建监控项是在键值里面查看。</p>
<br>
<p><strong>SNMP代理(SNMP agent)：</strong></p>
<p>在启用SNMP的设备(如打印机，交换机，路由器&hellip;)上使用SNMP监控，为了能够监控SNMP代理在这些设备上提供的数据，zabbix服务器初始化配置时必须具有SNMP支持。
仅通过UDP协议执行SNMP检查。</p>
<p><strong>配置SNMP监控：</strong></p>
<ol>
<li>使用SNMP接口为设备创建一个主机；</li>
<li>找出要监控项目的SNMP字符串；</li>
<li>创建一个监控项。</li>
</ol>
<br>
<p><strong>IPMI检查：</strong></p>
<p>你可以在zabbix中监控 <strong>智能平台管理接口(IPMI)</strong> 设备的运行状况和可用性。
要执行IPMI检查，zabbix服务器必须首先配置IPMI支持。</p>
<br>
<p><strong>简单检查：</strong></p>
<p>简单检查通常用于远程无代理监控服务。</p>
<br>
<p><strong>日志文件监控：</strong></p>
<p>zabbix可用于集中监控和分析 具有/不具有 日志转动能力的日志文件。
当日志文件包含某些字符串或字符串模式时，通知信息可用于警告用户。</p>
<br/>
<p><strong>计算监控项：</strong></p>
<p>计算监控项是创建虚拟数据源的一种方式。这些值将根据算术表达式定期计算。所有计算都由Server完成。</p>
<br>
**内部检查：**
内部检查可以监控zabbix的内部检查。即Server或Agent Server的运行情况。
<br>
**SSH检查：**
<p>运行SSH检查是作为无代理监控的，SSH检查不需要zabbix代理。
执行SSH检查zabbix服务器必须初始化配置为SSH2支持。</p>
<p>SSH检查提供两种身份验证方法，一种是用户/密码，另一种是基于密钥文件。</p>
<p>zabbix SSH 密钥配置:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">vim /etc/zabbix/zabbix_server.conf

<span class="c1">#SSHKeyLocation=</span>
<span class="nv">SSHKeyLocation</span><span class="o">=</span>/home/zabbix/.ssh

usermod -m -d /home/zabbix zabbix
chown zabbix:zabbix /home/zabbix
chmod <span class="m">700</span> /home/zabbix
<span class="nb">cd</span> /home/zabbix <span class="o">&amp;&amp;</span> su zabbix

ssh-keygen -t rsa
</code></pre></td></tr></table>
</div>
</div><br>
<p><strong>外部检查：</strong></p>
<p>外部检查是由zabbix Server通过运行shell脚本或二进制的检查。
外部检查不需要再被监控的主机上运行任何代理。</p>
<br/>
<p><strong>汇总检查：</strong></p>
<p>在汇总检查中，zabbix通过直接从数据库中查询监控信息，然后进行信息聚合。
聚合检查不需要再被监控的主机上运行任何代理。</p>
<br>
<p><strong>捕捉器监控项：</strong></p>
<p>捕捉器监控项接收传入的数据，而不是查询它。对于想要推送到zabbix的任何数据都是适用的。</p>
<p>要使用捕捉器监控项，需要在zabbix中建立一个捕捉器监控项，将数据送给zabbix。</p>
<br>
<p><strong>JMX监控项：</strong></p>
<p>JMX监控可用于监视Java应用程序的JMX计数器。
JMX监视器以zabbix守护进程方式运行，名为zabbix java gateway。</p>
<br/>
<p><strong>ODBC监控：</strong></p>
<p>ODBC监控对应于zabbix web管理端中的数据库监控器监控项类型。
ODBC是用于访问 数据库管理系统(DBMS) 的C语言中间件API。</p>
<p>zabbix可以查询ODBC支持的任何数据库。为了实现监控，zabbix不直接连接到数据库，而是使用ODBC中设置的ODBC接口和驱动。
该功能允许为多个目的更加有效地监控不同的数据库。</p>
<br/>
<h3 id="历史与趋势history-and-trends">历史与趋势(history and trends)</h3>
<p>历史与趋势是zabbix中存储数据的两种方式。
历史保持每个收集的值，而趋势是每小时的平均信息。</p>
<p>建议保持的历史数据尽可能少，但可以保留更多的趋势数据。</p>
<br>
<h3 id="用户自定义参数user-parameter">用户自定义参数(user parameter)</h3>
<p>有时你想运行一个代理检查，但它不是zabbix预定义的。这时就能用到<strong>用户参数</strong>。
用户参数是由zabbix代理之星的命令，最多可以返回512KB的数据。
<strong>key</strong> 是唯一的。</p>
<p>用户参数用法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">UserParameter</span><span class="o">=</span>&lt;key&gt;,&lt;command&gt;

<span class="c1">#栗子</span>
<span class="nv">UserParameter</span><span class="o">=</span>ping,echo <span class="m">1</span>
<span class="c1">#使用ping键为一个监控项返回 1</span>

<span class="c1">#复杂栗子</span>
<span class="nv">UserParameter</span><span class="o">=</span>mysql.ping,mysqladmin -uroot -ppwd ping <span class="p">|</span> grep -c <span class="s1">&#39;alive&#39;</span>
<span class="c1">#mysqld状态为alive返回1，否则0</span>

<span class="c1">#灵活的用户参数</span>
<span class="nv">UserParameter</span><span class="o">=</span>key<span class="o">[</span>*<span class="o">]</span>,command
<span class="c1">#[*]定义该key接受括号内的参数</span>

<span class="c1">#栗子</span>
<span class="nv">UserParameter</span><span class="o">=</span>ping<span class="o">[</span>*<span class="o">]</span>,echo <span class="nv">$1</span>

<span class="nv">UserParameter</span><span class="o">=</span>mysql.ping<span class="o">[</span>*<span class="o">]</span>,mysqladmin -u<span class="nv">$1</span> -p<span class="nv">$2</span> ping <span class="p">|</span> grep -c <span class="s1">&#39;alive&#39;</span>
<span class="c1">#mysql.ping[zabbix,passwd]</span>

<span class="nv">UserParameter</span><span class="o">=</span>wc<span class="o">[</span>*<span class="o">]</span>,grep -c <span class="s2">&#34;</span><span class="nv">$2</span><span class="s2">&#34;</span> <span class="nv">$1</span>
<span class="c1">#wc[/etc/passwd,root]</span>
</code></pre></td></tr></table>
</div>
</div><br>
**用户自定义参数扩展zabbix代理：**
是将key添加到被监控的主机哦！
```sh
#编写命令--SQL查询总数
mysqladmin -uxxx -pxxx status | cut -f4 -d":" | cut -f1 -d"S"
<p>#将命令添加到zabbix_agentd.conf
vim /etc/zabbix/zabbix_agentd.conf</p>
<p>#找到如下字段</p>
<h3 id="option-userparameter">Option: UserParameter</h3>
<p>UserParameter=mysql.totalquery,mysqladmin -uroot -pxxx status | cut -f4 -d&quot;:&quot; | cut -f1 -d&quot;S&quot;
#mysql.totalquery这个key是唯一的标识符</p>
<p>#测试此参数
##测试参数可用与否很重要哈
zabbix_agentd -t mysql.totalquery</p>
<p>#重启zabbix-agent，将重新加载配置
zabbix_get -s $host -k mysql.totalquery</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">

&lt;br&gt;

### 可加载模块(loadable modules)
可加载模块提供了一种关于zabbix性能扩展的选项。

可加载模块基本上只zabbix守护程序使用的共享库，并在启动时加载。
可加载模块具有很多优点，卓越的性能和可实现任何逻辑的能力，更重要的是使用和共享了zabbix模块的开发能力。



&lt;br/&gt;

### windows性能计数器(windows perfomance counter)
使用perf_counter[]key有效的监控windows性能计数器



&lt;br&gt;

### 批量更新(mass update)
使用批量更新功能，可一次更改多个监控属性。



&lt;br&gt;

### 值映射(value mapping)
对于接收值更人性化的表示，可以使用包含数值和字符串之间的映射的**值映射**。

如：

- 0 ---&gt; error
- 1 ---&gt; true
- F ---&gt; Full
- D ---&gt; Differential
- I ---&gt; Incremental
- ...



&lt;br/&gt;

### 应用集(Application)

**应用集**对逻辑组中的监控项进行分组。

如，对MongoDB的可用性，空间，负载，慢查询，执行命令...，可归于 MongoDB应用于中。



&lt;br&gt;

### 队列(queue)

**队列**显示正在等待刷新的监控项。
队列只是一个逻辑表达的数据。

队列显示的统计信息是zabbix服务器性能是否健康的指标。
在 管理--队列 下对去队列。



&lt;br/&gt;

### 值缓存(value cache)

为了计算触发表达式，以及让计算/聚合监控项和一些宏更快，zabbix服务器支持值的缓存选项。

在内存中的缓存可用于访问历史数据，而不用之间调用数据库。如果缓存中不存在历史值，则从数据库请求缺少的值，并相应地跟新缓存。

要启用值缓存功能，修改zabbix_server.conf中可选的ValueCacheSize参数。




&lt;br&gt;
&lt;br/&gt;


## 触发器(Trigger)

触发器是评估有项目采集的数据并表示当前系统状况的逻辑表达式。
触发器表达式允许定义一个什么状况的数据是“可接受”的阈值。如果超过了可接受状态，则触发器会被触发。


&lt;br&gt;

### 配置一个触发器(configuring a trigger)
在主机里面配置触发器。


&lt;br/&gt;

### 触发器表达式(trigger expression)

一个简单有效的表达式看起来像：

```sh
{&lt;server&gt;:&lt;key&gt;.&lt;function&gt;(&lt;parameter&gt;)}&lt;operator&gt;&lt;constant&gt;

#如
{192.168.1.7:agent.ping.time()}=0
</code></pre></td></tr></table>
</div>
</div><p><strong>函数参数(function parameters)：</strong></p>
<p>大多数数字型的函数接受秒数来作为参数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">#600s内所有值的总和
sum(600)

#随后5个值总和
sum(#5)

avg()
count()
last()
min()
max()

#5m 可被 300s 代替
#1k 代表 1024bytes
</code></pre></td></tr></table>
</div>
</div><p><strong>运算符(operators)：</strong></p>
<p>优先级	|	运算符	|	定义</p>
<ul>
<li>|	-	|	-
1	|	-	|	负号(minus)
2	|	not	|	逻辑非(NOT)
3	|	*, /	|	乘，除
4	|	+, -	|	加，减
5	|	&lt;, &lt;=, &gt;, &gt;=	|	-
6	|	=, &lt;&gt;	| 相等，不等于
7	|	and	|	逻辑与
8	|	or	|	逻辑或</li>
</ul>
<p><strong>触发器示例：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">{</span>www.zabbix.com:system.cpu.load<span class="o">[</span>all,avg1<span class="o">]</span>.last<span class="o">()}</span>&gt;5

<span class="o">{</span>www.zabbix.com:system.cpu.load<span class="o">[</span>all,avg1<span class="o">]</span>.last<span class="o">()}</span>&gt;5 or <span class="o">{</span>www.zabbix.com:system.cpu.load<span class="o">[</span>all,avg1<span class="o">]</span>.min<span class="o">(</span>10m<span class="o">)}</span>&gt;2

<span class="o">{</span>www.zabbix.com:net.if.in<span class="o">[</span>eth0,bytes<span class="o">]</span>.min<span class="o">(</span>5m<span class="o">)}</span>&gt;100k

<span class="o">{</span><span class="nv">$url1</span>:net.tcp.service<span class="o">[</span>smtp<span class="o">]</span>.last<span class="o">()}=</span><span class="m">0</span> and <span class="o">{</span><span class="nv">$url2</span>:net.tcp.service<span class="o">[</span>smtp<span class="o">]</span>.last<span class="o">()}=</span><span class="m">0</span>

<span class="o">{</span><span class="nv">$host</span>:icmpping.count<span class="o">(</span>30m,0<span class="o">)}</span>&gt;5

<span class="o">{</span><span class="nv">$host</span>:system.cpu.load<span class="o">[</span>all,avg1<span class="o">]</span>.min<span class="o">(</span>5m<span class="o">)}</span>&gt;2 and <span class="o">{</span><span class="nv">$hsot</span>:system.cpu.load<span class="o">[</span>all,avg1<span class="o">]</span>.time<span class="o">()}</span>&gt;000000 and <span class="o">{</span><span class="nv">$host</span>:system.cpu.load<span class="o">[</span>all,avg1<span class="o">]</span>.time<span class="o">)()}</span>&lt;<span class="m">060000</span>

...
</code></pre></td></tr></table>
</div>
</div><p><strong>滞后(Hysteresis):</strong></p>
<p>有时候需要一个触发器状态OK和PROBLEM之间的间隔，而不是简单的阈值。</p>
<p>要做到这一点，我们首先定义一个PROBLEM事件的触发器表达式，然后为OK选择 ‘Recovery expression’，并未OK事件书如不同的表达式</p>
<p>如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">#Problem expression
{server:temp.last()}&gt;20

#Recovery expression
{server:temp.last()}&lt;=15

#两者之间便有了几个滞后值
</code></pre></td></tr></table>
</div>
</div><br>
<h3 id="触发器依赖trigger-dependency">触发器依赖(trigger dependency)</h3>
<p>有时候，一台主机的可用性取决于另一台主机。如一台路由器后的上网设备。
这就是主机之间某些依赖关系可能有用的地方，依赖关系设置的通知可能会被抑制，而只发送根本问题的通知。</p>
<p>zabbix中触发器的依赖，一个触发器可能有多个依赖于它的触发器。</p>
<p>路由器和路由器后的Server同时宕机，如果有依赖关系，则zabbix不会执行服务器的触发动作。
值得注意的是，如果触发器所依赖的触发器被禁用，则次触发器的事件和动作将不会被抑制。</p>
<br>
<h3 id="批量更新">批量更新</h3>
<p>使用批量更新，可一次更改一些触发器的某些属性。</p>
<br/>
<h3 id="触发器严重性trigger-severity">触发器严重性(trigger severity)</h3>
<p>触发器严重性定义了触发器的重要程度:</p>
<ol>
<li>未分类(not classified), 灰色</li>
<li>信息(information), 淡蓝</li>
<li>警告(warning), 黄色</li>
<li>一般严重(average), 橙色</li>
<li>严重(High), 淡红</li>
<li>灾难(disaster), 红色</li>
</ol>
<br>
<h3 id="自定义触发器严重性customising-trigger">自定义触发器严重性(customising trigger)</h3>
<p>在 管理 &ndash; 一般 &ndash; 触发器严重性，里面自定义触发器严重性。</p>
<br/>
<h3 id="预测触发功能predictive-trigger-function">预测触发功能(predictive trigger function)</h3>
<p>有时候有即将到来的问题的迹象。可以发现这些迹象，以便提前采取行动，以减小影响。</p>
<p>zabbix具有基于历史数据预测受监视系统的未来行为的工具，这些工具通过预测触发功能实现。</p>
<br>
<h3 id="事件标签event-tag">事件标签(event tag)</h3>
<p>在zabbix中可以自定义事件标签，在触发器级别上定义事件标签。在事件标签定以后，相应的新事件被标记为时间标签数据。
在拥有自定义时间标签的情况下，可以变得更加灵活。</p>
<p>例如：</p>
<ol>
<li>识别日志文件中的问题并单独关闭他们；</li>
<li>用它来过滤通知；</li>
<li>查看前端的事件标签信息；</li>
<li>从项目值中提取的信息作为标签值；</li>
<li>在通知中更好地识别问题；</li>
<li>通过使用模板级别的标签来建华配置任务；</li>
<li>使用低级别发现的标签创建触发器。</li>
</ol>
<br>
<br>
<h2 id="事件events">事件(Events)</h2>
<p>zabbix可以生成一下几种类型的事件：</p>
<ol>
<li>trigger events-触发器事件；</li>
<li>discovery events-发现事件；</li>
<li>auto registration events-自动注册事件；</li>
<li>internal events-内部事件；</li>
</ol>
<p>事件以时间戳，并可以发送Email等基础动作。
在 监控-问题 里面查看信息信息。</p>
<br>
<h3 id="触发器事件生成trigger-events-generation">触发器事件生成(trigger events generation)</h3>
<p>触发器状态的变化是事件最常见和最重要的来源。每次触发器的状态改变时，都会生成一个事件。
改时间包含了触发器状态变更的详细信息、发生时间以及信息的状态。</p>
<p>触发器会创建两种类型的事件：问题(problem)和正常(OK)</p>
<br>
<h3 id="手动关闭问题事件manual-closing-of-problems">手动关闭问题事件(manual closing of problems)</h3>
<p>当触发器状态从“问题(problem)”变成“正常(OK)”时，很难判断是通过触发器表达式的方式解决。这时就需要手动解决。</p>
<p>只有在触发器中启用 “允许手动关闭” 选项，问题事件才可以被手动关闭。</p>
<br>
<h3 id="其他事件来源other-event-source">其他事件来源(other event source)</h3>
<p>zabbix定期扫描网络发现规则中定义的IP范围，可以为每个规则单独配置检查频率。一旦发现主机或服务，就会生成一个发现事件。</p>
<p>zabbix可以生成以下事件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Service Up/Down
Host Up/Down
Service Discovered/Lost
Host Discovered/Lost
</code></pre></td></tr></table>
</div>
</div><br>
<br/>
<h2 id="事件关联event-correlation">事件关联(event correlation)</h2>
<p>通常，在zabbix中正常事件会关闭所有的问题事件，但在某些情况下需要更细致的方法。可以根据<strong>事件标签</strong>关联问题事件。
如，当监控日志文件时，在日志文件中想要发现某些问题，并将它们单独关闭，而不是一起关闭。</p>
<br>
<br/>
<h2 id="可视化visualisation">可视化(visualisation)</h2>
<h3 id="图形graphs">图形(graphs)</h3>
<p>大量的监控数据被采集到zabbix中，如果能用可视化的表现形式来查看，那就直观和容易多了。</p>
<p>zabbix为用户提供了如下图形：</p>
<ol>
<li>监控项数据的内置简单图形 “simple graphs”；</li>
<li>创建更复杂的自定义图形 “customised graphs”；</li>
<li>特定图形 &ldquo;ad-hosc graphs&quot;快速访问几个监控项的数据比较。</li>
</ol>
<p><strong>简单图形(simple graphs)：</strong>
zabbix提供的简单图形，用来可视化显示监控项采集到的数据。并不需要配置就可以查看。</p>
<p>通过 监控-最新数据-图形 来展示图形。</p>
<p><strong>自定义图形(customised graphs)：</strong>
自定义图形，提供定制功能。这就有点厉害了。这个是手动配置的。
可以为单个主机、多个主机、单个模板、多个模板创建自定义图形。</p>
<p>在 配置-主机-图形-创建图形 里编辑图形属性；
图形编辑后可点击预览。</p>
<p><strong>特设图形(ad-hoc graphs)：</strong>
简单图形和自定义图形都不允许快速创建多个监控项目数据的比较图形，工作量小且没有维护。</p>
<p>在 检测-最新数据-旋转监控项前复选框-显示数据图(显示堆叠数据图) 下， 里面也包含了 正常和层积 的图形风格。</p>
<br>
### 拓扑图(networking maps)
<p>运维人员如果想要了解网络环境的基础设施状况，可以在zabbix中创建网络拓扑图。</p>
<p><strong>配置拓扑图(configurating network maps):</strong></p>
<p>在 监控-拓扑图 下，可以创建拓扑图。点击拓扑图中的 构造函数 选项，来打开编辑区域。
然后在编辑区域中添加元素和链接元素。</p>
<p><strong>链接指示器(link indicators):</strong>
可以为网络拓扑图中的元素之间的链接分配一些触发器，当这些触发器状况为“Problem”时，可以在链接上体现出来。
如果多个触发器进入&quot;Problem&quot;状态，则严重程度最高的将决定链接的颜色和样式。</p>
<br>
### 聚合图形(screen)
<p>在zabbix的聚合图形页面上，你可把各种来源的信息聚集到一起，一边在单个屏幕上快速查看。
在 监测-图形聚合 下，对其进行创建、配置、管理和查看。</p>
<p>基本上，聚合图形是一个表格，你选择把每个表格有多少单元格以及其中要显示的元素。
元素如下：</p>
<ul>
<li>简单图形；</li>
<li>简单图形原型；</li>
<li>用户自定义图形；</li>
<li>自定义图形原型；</li>
<li>拓扑图；</li>
<li>其他聚合图形；</li>
<li>纯文本信息；</li>
<li>服务器信息；</li>
<li>触发器信息；</li>
<li>主机/主机组信息；</li>
<li>系统状态；</li>
<li>数据概述；</li>
<li>时钟；</li>
<li>事件历史；</li>
<li>动作历史；</li>
<li>URL。</li>
</ul>
<br>
### 幻灯片演示(slide shows)
<p>在幻灯片演示中，可以配置多个聚合图形以设定的间隔逐个显示。
在 监测-聚合图形-幻灯片演示 下。</p>
<br>
<br/>
## 模板(template)
<p>模板是可以方便地应用于多个主机的一组实体。</p>
<p><strong>配置模板(configuring a template)：</strong>
配置模板需要首先通过定义一些参数来创建模板，然后添加实例。
在 配置-模板-创建模板</p>
<p><strong>链接模板(linking)：</strong>
链接是将模板应用于主机的过程，之后主机将拥有模板的所有实体。</p>
<p><strong>嵌套(nesting)：</strong>
嵌套是一种包含一个或多个其它模板的模板方式。
可以在一个嵌套模板中奖一些模板链接在一起。</p>
<p>嵌套的好处在于，您只需要讲一个模板链接到主机，并且主机会自动继承链接的模板的所有实体。</p>
<br>
<br>
<h2 id="事件通知notifications-upon-events">事件通知(notifications upon events)</h2>
<p>当配置了一些项目和触发器，并且由于触发器改变状态，现在正在发生一些事件，之后就要考虑 action。
发送通知是zabbix提供的主要操作之一。</p>
<p>为了能够发送和接收通知，必须：</p>
<ol>
<li>定义一些media；</li>
<li>配置action，向指定的media发送消息。</li>
</ol>
<p>action由condition和operation组成。当条件满足是，执行操作。
操作主要是 <strong>发送消息</strong>和<strong>执行远程命令</strong>。</p>
<br>
<h3 id="media类型">media类型</h3>
<p>媒体是zabbix中发送通知和警报的传送通道。</p>
<p><strong>E-mail:</strong></p>
<p>在 管理-媒体类型 下，配置Email。</p>
<p><strong>SMS：</strong></p>
<p>zabbix支持使用连接到zabbix-server的串行端口的串行GSM调制解调器发送SMS消息。</p>
<p>确保：</p>
<ul>
<li>串行设备的速度(在Linux下通常为/dev/ttyS0) 与 GSM调制解调器的速度相匹配。zabbix没有设置串行链路的速度，它使用默认设置。</li>
<li>zabbix用户对串行设备有读写访问权限。</li>
<li>GSM调制解调器输入PIN码，并在电源复位后保留PIN码。或者在SIM卡上禁用PIN。</li>
</ul>
<p>管理-媒体类型下
要为用户分配电话号码：管理-用户-报警媒介，添加报警媒介(如电话号码等)</p>
<p><strong>Jabber：</strong></p>
<p>zabbix支持发送jabber消息。</p>
<p><strong>Ez Texting：</strong></p>
<p>可以使用 zabbix技术合作伙伴 Ez Texting发送信息。</p>
<p><strong>脚本：</strong></p>
<p>警报脚本在zabbix服务器上执行，这些脚本位于服务器配置文件中定义的目录中(AlertScriptsPath)。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">cat /etc/zabbix/zabbix_server.conf

<span class="nv">AlertScriptsPath</span><span class="o">=</span>/usr/lib/zabbix/alertscripts


<span class="c1">#创建报警脚本</span>
vim /usr/lib/zabbix/alertscripts/zabbix_test.sh

<span class="c1">#!/bin/bash</span>
<span class="nv">to</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">subject</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">body</span><span class="o">=</span><span class="nv">$3</span>


<span class="c1">#可以同时给多个用户发送，用空格隔开</span>
cat <span class="s">&lt;&lt;EOF | mail -s &#34;$subject&#34; &#34;to&#34;
</span><span class="s">$body
</span><span class="s">EOF</span>
</code></pre></td></tr></table>
</div>
</div><p>然后我们在创建脚本媒体的时候，写入相关参数。</p>
<br>
### actions
<p>可以根据所有支持的类型的时间定义操作：</p>
<ul>
<li>触发事件：当trigger的状态从OK转到Problem或回转时；</li>
<li>发现事件；</li>
<li>自动注册事件；</li>
<li>内部事件；</li>
</ul>
<p>配置-动作-创建动作</p>
<h4 id="条件condition">条件(condition)</h4>
<p>只有在事件与定义的条件匹配的情况下才执行操作。</p>
<p>注意运算类型：似与非似</p>
<h4 id="操作operation">操作(operation)</h4>
<p>操作：发送信息，执行远程命令。</p>
<h5 id="发送消息">发送消息</h5>
<h5 id="远程命令">远程命令</h5>
<p>(不支持在zabbix-agent上执行远程命令，需要在zabbix-server到代理的命令才能直接连接。远程命令限制255字符，可以将过个命令放置于新行上来执行过个命令。及时目标主机处于维护状态，也会执行远程命令).</p>
<p>配置-动作-操作，在操作细节中修改操作类型为远程命令。</p>
<p>在Zabbix代理（自定义脚本）上执行的那些远程命令必须首先在相应的命令中启用 zabbix_agentd.conf.确保 EnableRemoteCommands 参数设置为 1 并取消注释。 如果更改此参数，请重新启动代理守护程序。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">vim /etc/zabbix/zabbix_agentd.conf


<span class="nv">EnableRemoteCommands</span><span class="o">=</span><span class="m">1</span>


<span class="nb">cd</span> /usr/lib/zabbix/alertscripts
<span class="c1">#或修改zabbix-server.conf中的文件位置</span>
vi sendmail.sh


chown zabbix.zabbix ./sendmail.sh <span class="o">&amp;&amp;</span> chmod a+x ./sendmail.sh
</code></pre></td></tr></table>
</div>
</div><p>接下来在动作中选择为执行远程命令，并在相应位置输入命令。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/remotecommand.png"
        data-srcset="/images/Zabbix/remotecommand.png, /images/Zabbix/remotecommand.png 1.5x, /images/Zabbix/remotecommand.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/remotecommand.png"
        title="/images/Zabbix/remotecommand.png" /></p>
<p>支持自定义脚本、SSH、Telnet等方式。</p>
<p><strong>在信息中使用宏(using macros in messages)：</strong>
在消息主题和消息文本中，可使用宏来更有效的问题报告。</p>
<p><strong>恢复操作(recovery operation):</strong>
恢复操作允许在问题解决时通知我们。
恢复操作支持消息和远程命令。</p>
<br>
<br>
<h2 id="宏macros">宏(macros)</h2>
<p>官方支持的宏的完整列表：<a href="https://www.zabbix.com/documentation/3.4/manual/appendix/macros/supported_by_location">https://www.zabbix.com/documentation/3.4/manual/appendix/macros/supported_by_location</a></p>
<p>zabbix支持许多在多种情况下使用的宏。宏是一个变量，由如下特殊语法标识。</p>
<p>宏类似于全局变量，宏是特别有用的，特别是在报警动作中。对于不同的细节加上特定的宏，能够使报警信息更加详细。</p>
<p><code>{MACRO}</code></p>
<p>根据在上下文汇总，宏解析为一个特殊的值。有效地使用宏可以节省时间，并使zabbix更加高效。</p>
<p>宏可以在监控项键值参数中使用。宏只能用在监控项键值参数的一部分中。
如<code>item.key[server_{HOST.HOST}_local]</code> 。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/MACRO.png"
        data-srcset="/images/Zabbix/MACRO.png, /images/Zabbix/MACRO.png 1.5x, /images/Zabbix/MACRO.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/MACRO.png"
        title="宏" /></p>
<br>
<h3 id="宏函数macro-function">宏函数(macro function)</h3>
<p>宏函数能提供自定义宏值的功能。</p>
<p>宏函数语法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">{&lt;macro&gt;.&lt;func&gt;(&lt;params&gt;)}

#&lt;macro&gt;, 要定义的宏
#&lt;func&gt;, 要应用的函数
#&lt;params&gt;, 以逗号分隔的函数参数列表

#栗子
{{ITEM.VALUE}.regsub{pattern, output}}
</code></pre></td></tr></table>
</div>
</div><br>
<h3 id="用户宏user-macro">用户宏(user macro)</h3>
<p>除了支持开箱即用的宏之外，zabbix还支持更灵活的用户宏。</p>
<p>用户宏可在全局、模板和主机级别进行定义。有一个特殊语法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">{$MACRO}
</code></pre></td></tr></table>
</div>
</div><p>用户宏可用于：</p>
<ul>
<li>监控项名称；</li>
<li>监控项键值参数；</li>
<li>触发器名称和描述；</li>
<li>触发器表达式参数和常量；</li>
<li>许多其他位置。</li>
</ul>
<h3 id="自动发现宏lld">自动发现宏(LLD)</h3>
<p>有一种自动发现(LLD)函数中使用的宏类型，可用于创建监控项、触发器和图形原型。然后，当发现真实的文件系统、网络接口等，这些宏将替换为真实的值，并且以这些值来创建真实的监控项、触发器和图形。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">{#MACRO}
</code></pre></td></tr></table>
</div>
</div><br>
<h2 id="用户和用户组user-and-group">用户和用户组(user and group)</h2>
<p>zabbix中所有用户都通过web前端去访问zabbix应用程序。并为每一个用户分配唯一的登录名和密码，被加密储存于zabbix数据库中。</p>
<p><strong>配置用户(configuring user)</strong>
管理-用户，创建和管理用户。</p>
<p><strong>权限(permission)</strong>
可定义相应的用户类型，如用户，管理员和超级管理员。</p>
<p><strong>用户组(groups)</strong>
管理-用户组，创建和配置用户组。</p>
<br>
<br/>
<hr>
<h1 id="服务监控service-monitoring">服务监控(service monitoring)</h1>
<p>服务监控，旨在帮助那些想要高级业务监控的人。
在很多情况下，我们关注的不是底层细节，而是提供的可用性服务。</p>
<p>服务是分层表示监控数据。</p>
<blockquote>
<p>IT</p>
<blockquote>
<p>Workstations</p>
<blockquote>
<p>workstation1
workstation2</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>Services</p>
</blockquote>
</blockquote>
<p>配置-服务，最高节点的服务是&rsquo;root'。
你可以通过添加低级服务节点和各个节点服务创建下层层次结构。</p>
<br>
<hr>
<br/>
<h1 id="web监控web-monitoring">Web监控(web monitoring)</h1>
<p>配置-主机-web监测，创建或修改web监测信息。
可使用zabbix检查几个网站可用性方面。(zabbix中包含libcurl库才行)</p>
<p>要使用web监控，需要定义web场景。包括一个或多个HTTP请求或步骤。Zabbix-Server根据预定义的命令周期性的执行这些步骤。</p>
<p>Web监测中的**要求的字段(required string)**支持正则表达式，所以这对于检索页面信息很有用。这个真的很有用！</p>
<p>所有web场景会收集下列数据：</p>
<ul>
<li>整个场景中所有步骤的平均下载速度；</li>
<li>失败的步骤数量；</li>
<li>最后一次错误信息</li>
</ul>
<p>web场景的所有步骤，都会收集下列数据：</p>
<ul>
<li>平均下载速度；</li>
<li>响应时间</li>
<li>HTTP状态吗</li>
</ul>
<br>
<h2 id="web监控项web-monitoring-items">Web监控项(web monitoring items)</h2>
<p>在创建web场景时，会自动添加一些新监控项进行监控。</p>
<p>创建场景后，zabbix会自动添加以下监控项进行监控，将它们链接到所选的应用程序。</p>
<ul>
<li>场景<scenario>的下载速度；</li>
<li>场景<scenario>的失败步骤；</li>
<li>场景<scenario>的最后一个错误消息；</li>
</ul>
<br>
<p><strong>举个栗子：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1">##创建Web监测</span>
<span class="c1">#配置-主机-Web监测-创建web监测</span>

URL：web.zabbix.me/monitor.php
要求的状态码：200
超时：20s


<span class="c1">##创建web监测触发器</span>
<span class="c1">#配置-主机-触发器-创建触发器</span>

严重性：一般严重
<span class="c1">#触发条件：状态码!=200</span>
表达式：N&lt;&gt;200


<span class="c1">##创建触发报警对应的动作</span>
<span class="c1">#配置-动作-创建动作</span>

<span class="c1">#触发条件</span>
<span class="nv">触发器示警度</span><span class="o">=</span>一般严重 or <span class="nv">触发器</span><span class="o">=</span>web.zabbix.me

<span class="c1">#操作：发送Email</span>
发送给zabbix administrator用户群组
仅送到Email
默认信息/自定义信息


<span class="c1">##在媒体类型中定义Email相关信息</span>
<span class="c1">#管理-报警媒体类型-Email</span>

SMTP服务器：smtp.xxx.com
smtp端口：465
SMTP电邮：发件人Email
安全链接：SSL/TLS
认证：Usernameand passwd
用户名：xxx
密码： xxx


<span class="c1">##接下来就可以测试接收报警Email了</span>
</code></pre></td></tr></table>
</div>
</div><br>
<br/>
<hr>
<h1 id="虚拟机监控vm-monitoring">虚拟机监控(VM monitoring)</h1>
<p>zabbix支持对VMware的监控，使用low-levle-discovery(LLD)自动发现VMware hypervisors和虚拟机，并根据事先定义的主机原型，为这些虚拟机建立主机，添加监控。</p>
<p>zabbix中提供了几个模板，可以直接用来解控VMware vCenter 或 ESX hypervisor。</p>
<br>
虚拟机监控分为两个步骤：
- 首先，zabbix是通过VMware collector进程来监控虚拟机。这些进程通过SOAP协议从VMware服务获取必要的信息，对其进行预处理并储存到zabbix-server共享内存中；
- 然后，zabbix-pollers通过zabbix简单检查VMware keys来检索这些数据。
<p>要使虚拟机监控正常工作，需要libxml2库和libcurl库的支持。</p>
<blockquote>
<p>配置-自动发现-创建自动发现
配置-主机-自动发现</p>
</blockquote>
<br>
<br/>
<hr>
<h1 id="维护maintenance">维护(maintenance)</h1>
<p>可在zabbix中为主机和主机组定义维护周期。
有两种维护类型：“继续对目标进行监控数据的收集” 和 “停止对目标进行监控数据的收集”</p>
<p>要在维护期间正常接收问题通知，必须在动作配置中的选项中取消选择暂停操作。
为了确保定期维护按照预期的时间进行，需要对zabbix的所有部分使用通用时区。</p>
<blockquote>
<p>配置-维护-创建维护期</p>
</blockquote>
<p>维护期的主机显示的是橙色背景！</p>
<br>
<br>
<hr>
<h1 id="事件确认event-acknowledgment">事件确认(event acknowledgment)</h1>
<p>zabbix中的问题事件可以由用户确认。</p>
<p>如果用户获得了有关问题时间的通知，可以访问zabbix前端，从时间导航到确认屏幕并确认问题。
当他们确认时，可输入评论或其他一些相关描述。
这样其他系统用户同样的问题，他们便会立即看到是否已被解决和目前的评论。</p>
<p>以这种方式，可以更协调的进行解决多个系统用户的问题的工作流程。</p>
<p>要确认事件，用户必须至少要有对相应触发器的读取权限。</p>
<br>
在Dashboard下，在出现的问题里，点击确认，进入确认事件。
也可在监控-问题下查看问题详细信息。
<br>
<br>
<hr>
<h1 id="配置导出导入configuration-exportimport">配置导出/导入(Configuration export/import)</h1>
<p>zabbix导入/导出功能，使得可以在一个zabbix系统与另一个zabbix系统之间交换各种配置实体。
类似于数据库的导入导出。即也可以对zabbix做备份。</p>
<p>可导出/导入的对象有：主机组； 模板； 主机； 拓扑； 图片； 聚合图形； 值映射。</p>
<p>数据也可导出：</p>
<ul>
<li>XML - 在前端</li>
<li>XML or JSON - 在zabbix API</li>
</ul>
<p>导出的详细信息：</p>
<ul>
<li>所有支持的元素都导出到一个文件中；</li>
<li>不导出从连链接模板继承的主机和模板实体；</li>
<li>由低级别发现创建的实体依赖于他们的任何实体不会导出。</li>
</ul>
<p>导入详细信息：</p>
<ul>
<li>第一次遇到错误停止导入；</li>
<li>导入支持XML和JSON文件；</li>
<li>使用“删除缺失”选项导入主机/模板时，导入的XML文件中不存在主机/模板宏也将被删除。</li>
</ul>
<br>
<br>
<hr>
<h1 id="将zabbix展现在nginx上">将Zabbix展现在Nginx上</h1>
<p>毕竟现在Nginx用的多，那就把Apache换成Nginx吧！</p>
<p>Nginx仓库:<a href="http://nginx.org/packages/">http://nginx.org/packages/</a></p>
<p>自己安装Nginx:</p>
<ol>
<li>下载<code>nginx-release-xx.rmp</code>仓库源来安装；</li>
<li>手动创建<code>/etc/yum.repo.d/nginx.repo</code>；</li>
<li>直接下载<code>ngix.rpm</code>来安装；</li>
<li>直接下载源码来安装。</li>
</ol>
<p>相较于Apache，Nginx也只是配置个server就行了。优化什么的自己弄。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">vim /etc/nginx/conf.d/zabbix.conf

server <span class="o">{</span>
	listen 80<span class="p">;</span>
    server_name zabbix.me<span class="p">;</span>
    root /usr/share/zabbix<span class="p">;</span>

    access_log  /var/log/nginx/zabbix.access.log  main<span class="p">;</span>

	allow 127.0.0.1<span class="p">;</span>
	allow Your-IP<span class="p">;</span>
    deny all<span class="p">;</span>

    location / <span class="o">{</span>
    	<span class="k">if</span> <span class="o">(</span>!-f <span class="nv">$request_filename</span><span class="o">)</span> <span class="o">{</span>
        	rewrite ^<span class="o">([</span>^<span class="se">\?</span><span class="o">]</span>+<span class="o">)</span>$ /index.php?1<span class="o">=</span><span class="nv">$1</span> last<span class="p">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    location ~ <span class="se">\.</span>php$ <span class="o">{</span>
    	root /usr/share/zabbix<span class="p">;</span>
        fastcgi_pass 127.0.0.1:9000<span class="p">;</span>
        fastcgi_index index.php<span class="p">;</span>
        fastcgi_param SCRIPT_FILENAME <span class="nv">$document_root</span>/<span class="nv">$fastcgi_script_name</span><span class="p">;</span>
        include fastcgi_params<span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>


nginx -t
systemctl start nginx
</code></pre></td></tr></table>
</div>
</div><p>下载就可以正常访问<code>zabbix-web</code>端了!</p>
<br>
<br/>
<hr>
<h1 id="zabbix监控">Zabbix监控</h1>
<p>Zabbix自带的templates基本涵盖了大部分监控信息。</p>
<p>大部分操作系统：</p>
<ul>
<li>OS Linux;</li>
<li>OS AIx;</li>
<li>OS FreeBSD;</li>
<li>OS Solaris;</li>
<li>OS Windows;</li>
<li>&hellip;</li>
</ul>
<p>大部分服务：</p>
<ul>
<li>CPU;</li>
<li>Filesystems;</li>
<li>HTTP/HTTPS service;</li>
<li>Memory;</li>
<li>Network interfaces;</li>
<li>Processes;</li>
<li>Secutity;</li>
<li>Zabbix server/agent/Proxy;</li>
<li>SMTP,POP,SSH,NTP, service;</li>
<li>ICMP Ping;</li>
<li>SNMP;</li>
<li>&hellip;</li>
</ul>
<p>虚拟机：</p>
<ul>
<li>VM VMware;</li>
<li>VM WMware Hypervisor;</li>
<li>&hellip;</li>
</ul>
<p>网络设备：</p>
<ul>
<li>Cisco;</li>
<li>Huawei;</li>
<li>TPLink;</li>
<li>HP;</li>
<li>&hellip;</li>
</ul>
<br>
除了Zabbix自带的templates，你还可以下载templates并导入zabbix-server。
<p>例如PHP-FPM, MongoDB, Apache, Nginx, Redis等额外软件的监控就需要下载额外templates。</p>
<br>
<br/>
<h2 id="监控mysql">监控MySQL</h2>
<h3 id="使用zabbix自带模板监控mysql">使用Zabbix自带模板监控MySQL</h3>
<p>Zabbix默认带有MySQL的监控和模板，所以无需再去下载。不过需要配置用户，密码，主机，端口等信息。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">vim /etc/zabbix/zabbix-agentd.d/userparameter_mysql.conf

<span class="c1">#For all the following commands HOME should be set to the directory that has .my.cnf file with password information.</span>
<span class="c1">#这句话叫我们新建一个带有mysql密码信息的.my.cnf文件</span>
<span class="c1">#并把此配置文件里面的HOME改为.my.cnf所的在目录</span>
<span class="c1">#.my.cnf文件里面的用户要对MySQL数据库有权限才行，没有权限请记得加</span>

<span class="o">[</span>mysql<span class="o">]</span>
<span class="nv">host</span><span class="o">=</span>localhost
<span class="nv">user</span><span class="o">=</span>zabbix
<span class="nv">password</span><span class="o">=</span>zabiix
<span class="nv">socket</span><span class="o">=</span>/var/lib/mysql/mysql.sock

<span class="o">[</span>mysqladmin<span class="o">]</span>
<span class="nv">host</span><span class="o">=</span>localhost
<span class="nv">user</span><span class="o">=</span>root
<span class="nv">password</span><span class="o">=</span>password
<span class="nv">socket</span><span class="o">=</span>/var/lib/mysql/mysql.sock



<span class="c1">#测试</span>
zabbix_get -s 127.0.0.1 -k mysql.ping
<span class="c1">#1</span>
</code></pre></td></tr></table>
</div>
</div><br/>
<br>
<h3 id="使用percona插件监控mysql">使用Percona插件监控MySQL</h3>
<p>Zabbix默认带有MySQL的监控和模板，所以无需再去下载。不过需要配置用户，密码，主机，端口等信息。
但是Zabbix自带的MySQL监控太简陋了。
所以使用Percona提供的模板及监控。</p>
<br>
<p>Percona Monitoring Plugins-URL:  <a href="https://www.percona.com/downloads/percona-monitoring-plugins/LATEST/">https://www.percona.com/downloads/percona-monitoring-plugins/LATEST/</a>
Percona Monitoring Plugins for Zabbix- Instructions:  <a href="https://www.percona.com/doc/percona-monitoring-plugins/LATEST/zabbix/index.html">https://www.percona.com/doc/percona-monitoring-plugins/LATEST/zabbix/index.html</a></p>
<p>此插件地址需要我们选择Percona-Version和Software平台。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/mysql01.png"
        data-srcset="/images/Zabbix/mysql01.png, /images/Zabbix/mysql01.png 1.5x, /images/Zabbix/mysql01.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/mysql01.png"
        title="Percona Monitoring Plugins" /></p>
<p>选择平台后，我们只需安装zabbix的rpm包就好：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1">#安装rpm包</span>
yum install -y https://www.percona.com/downloads/percona-monitoring-plugins/percona-monitoring-plugins-1.1.7/binary/redhat/7/x86_64/percona-zabbix-templates-1.1.7-2.noarch.rpm


<span class="c1">#安装软件</span>
<span class="c1">#注意php版本问题</span>
yum install -y percona-zabbix-templates

ls /var/lib/zabbix/percona
<span class="c1">#scripts目录有.sh脚本文件</span>
<span class="c1">#templates目录有配置文件和模板文件</span>



<span class="c1">#复制配置文件</span>
cp /var/lib/zabbix/percona/templates/userparameter_percona_mysql.conf /etc/zabbix/zabbix_agentd.d/
<span class="c1">#我看了一下，这个配置文件和zabbix自带的MySQL配置文件一样</span>


<span class="c1">#添加MySQL的相关信息</span>
vim /var/lib/zabbix/percona/scripts/ss_get_mysql_stats.php

<span class="nv">$mysql_user</span> <span class="o">=</span> <span class="s1">&#39;root&#39;</span><span class="p">;</span>
<span class="nv">$mysql_pass</span> <span class="o">=</span> <span class="s1">&#39;password&#39;</span><span class="p">;</span>
<span class="nv">$mysql_port</span> <span class="o">=</span> 3306<span class="p">;</span>
<span class="nv">$mysql_socket</span> <span class="o">=</span> <span class="s1">&#39;/var/lib/mysql/mysql.sock&#39;</span><span class="p">;</span>
<span class="nv">$mysql_flags</span> <span class="o">=</span> 0<span class="p">;</span>


<span class="c1">#测试脚本</span>
/var/lib/zabbix/percona/scripts/get_mysql_stats_wrapper.sh gg
<span class="c1">#10</span>


<span class="c1">#创建.my.cnf文件</span>
vim /etc/zabbix/zabbix_agentd.d/.my.cnf

<span class="o">[</span>mysql<span class="o">]</span>
<span class="nv">host</span><span class="o">=</span>localhost
<span class="nv">user</span><span class="o">=</span>root
<span class="nv">password</span><span class="o">=</span>password
<span class="nv">socket</span><span class="o">=</span>/var/lib/mysql/mysql.sock

<span class="o">[</span>mysqladmin<span class="o">]</span>
<span class="nv">host</span><span class="o">=</span>localhost
<span class="nv">user</span><span class="o">=</span>root
<span class="nv">password</span><span class="o">=</span>password
<span class="nv">socket</span><span class="o">=</span>/var/lib/mysql/mysql.sock

<span class="o">[</span>client<span class="o">]</span>
<span class="nv">host</span><span class="o">=</span>localhost
<span class="nv">user</span><span class="o">=</span>root
<span class="nv">password</span><span class="o">=</span>password
<span class="nv">socker</span><span class="o">=</span>/var/lib/mysql/mysql.sock


<span class="c1">#重启服务</span>
systemctl restart zabbix-agent


<span class="c1">#测试</span>
sudo -u zabbix -H /var/lib/zabbix/percona/scripts/get_mysql_stats_wrapper.sh running-slave
<span class="c1">#0/1</span>
</code></pre></td></tr></table>
</div>
</div><p>导入模板，模板文件位于：<code>/var/lib/zabbix/percona/templates/zabbix_agent_template_percona_mysql_server_ht_2.0.9-sver1.1.7.xml</code></p>
<p>但我直接导入模板时报错——标签无效 &ldquo;/zabbix_export/date&rdquo;: &ldquo;YYYY-MM-DDThh:mm:ssZ&rdquo; 预计。
此模板需要先导入Zabbix2.4后再导出，然后再导入到Zabbix3.4。太麻烦。
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/mysql02.png"
        data-srcset="/images/Zabbix/mysql02.png, /images/Zabbix/mysql02.png 1.5x, /images/Zabbix/mysql02.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/mysql02.png"
        title="导入percona模板" /></p>
<p>所以需要下载修改过的模板： <a href="http://jaminzhang.github.io/soft-conf/Zabbix/zbx_percona_mysql_template.xml">http://jaminzhang.github.io/soft-conf/Zabbix/zbx_percona_mysql_template.xml</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">wget http://jaminzhang.github.io/soft-conf/Zabbix/zbx_percona_mysql_template.xml
</code></pre></td></tr></table>
</div>
</div><p>下载之后导入模板，然后链接主机。
链接之后可以部分监控可能显示不支持的。</p>
<p>如：Received value [rm: 无法删除&rdquo;/tmp/localhost-mysql_cacti_stats.txt&quot;: 不允许的操作0] is not suitable for value type [Numeric (float)]
没有权限。
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/mysql03.png"
        data-srcset="/images/Zabbix/mysql03.png, /images/Zabbix/mysql03.png 1.5x, /images/Zabbix/mysql03.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/mysql03.png"
        title="/images/Zabbix/mysql03.png" /></p>
<p>解决办法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">cd</span> /tmp
chown -R zabbix:zabbix localhost-mysql_cacti_stats.txt

systemcet restart zabbix-agent
</code></pre></td></tr></table>
</div>
</div><br>
<br>
<h2 id="监控mongodb">监控MongoDB</h2>
<p><strong>感谢大神：</strong></p>
<ul>
<li>MongoDB-templates: <a href="https://share.zabbix.com/databases/mongodb/mongodb-for-zabbix-3-2">https://share.zabbix.com/databases/mongodb/mongodb-for-zabbix-3-2</a> ;</li>
<li>GitHub: <a href="https://github.com/oscm/zabbix/tree/master/mongodb">https://github.com/oscm/zabbix/tree/master/mongodb</a></li>
<li>此github-repo中还包含了<code>Oracle</code>, <code>php-fpm</code>, <code>postfix</code>, <code>redis</code>, <code>Nginx</code>。可参看README.md来配置zabbix对它们的监控。</li>
</ul>
<br/>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/zabbix_master.png"
        data-srcset="/images/Zabbix/zabbix_master.png, /images/Zabbix/zabbix_master.png 1.5x, /images/Zabbix/zabbix_master.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/zabbix_master.png"
        title="./master" /></p>
<br>
### 安装步骤
<p><strong>1. 在zabbix-agent安装<code>jq</code></strong>
jq - Command-line JSON processor;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">yum install -y jq
</code></pre></td></tr></table>
</div>
</div><br>
**2. 在zabbix-agent的MongoDB中创建用于监控的账号**
创建用于读取MongoDB相关信息的账户及其权限。
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">mongo

&gt;use admin

&gt;db.createUser<span class="o">(</span>
  <span class="o">{</span>
	user:<span class="s1">&#39;zabbix&#39;</span>,
	pwd:<span class="s1">&#39;zabbix&#39;</span>,
	roles:<span class="o">[{</span>
		role:<span class="s1">&#39;clusterMonitor&#39;</span>,
		db:<span class="s1">&#39;admin&#39;</span><span class="o">}]</span>
  <span class="o">}</span>
<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><br>
**3. 在agent下载github仓库的MongoDB模板等文件**
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">wget https://codeload.github.com/oscm/zabbix/zip/master -O master.zip
<span class="c1">#这里面不仅仅有mongodb，还有redis,php等。</span>
<span class="c1">#我们只需要进入mongodb目录就好</span>

unzip master.zip


<span class="nb">cd</span> ./zabbix-master/mongodb
ls

<span class="c1">#mongodb.sh , 执行脚本</span>
<span class="c1">#userparameter_mongodb.conf ，配置脚本</span>
<span class="c1">#zbx_export_templates.xml，zabbix模板文件</span>
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/zabbix_mongodb1.png"
        data-srcset="/images/Zabbix/zabbix_mongodb1.png, /images/Zabbix/zabbix_mongodb1.png 1.5x, /images/Zabbix/zabbix_mongodb1.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/zabbix_mongodb1.png"
        title="./master/mongodb" /></p>
<br>
**4. 移动并配置mongodb.sh**
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">cp ./mongodb.sh /etc/zabbix

chmod a+x /etc/zabbix/mongodb.sh


vi mongodb.sh

<span class="c1">#如果HOST,PORT不是默认，请修改</span>
<span class="nv">DB_HOST</span><span class="o">=</span>127.0.0.1
<span class="nv">DB_PORT</span><span class="o">=</span><span class="m">27017</span>
<span class="nv">DB_USERNAME</span><span class="o">=</span>zabbix
<span class="nv">DB_PASSWORD</span><span class="o">=</span>zabbix
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/zabbix_mongodb2.png"
        data-srcset="/images/Zabbix/zabbix_mongodb2.png, /images/Zabbix/zabbix_mongodb2.png 1.5x, /images/Zabbix/zabbix_mongodb2.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/zabbix_mongodb2.png"
        title="mongodb.sh" /></p>
<br>
**5. 移动并修改userparameter_mongodb.conf**
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">cp ./zabbix-master/userparameter_mongodb.conf /etc/zabbix/zabbix_agentd.d

vi ./userparameter_mongodb.conf

<span class="nv">UserParameter</span><span class="o">=</span>mongodb.status<span class="o">[</span>*<span class="o">]</span>,/etc/zabbix/mongodb.sh <span class="nv">$1</span> <span class="nv">$2</span> <span class="nv">$3</span> <span class="nv">$4</span> <span class="nv">$5</span>
<span class="c1">#修改为mongdb.sh真实位置</span>
<span class="c1">#这个是用户自定义的参数，可以之间写入到zabbix_agent.conf里面</span>
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/zabbix_mongodb3.png"
        data-srcset="/images/Zabbix/zabbix_mongodb3.png, /images/Zabbix/zabbix_mongodb3.png 1.5x, /images/Zabbix/zabbix_mongodb3.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/zabbix_mongodb3.png"
        title="userparameter_mongodb.conf" /></p>
<br>
**6. 重启zabbix-agent**
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">systemctl restart zabbix-agent
</code></pre></td></tr></table>
</div>
</div><br>
**7. 在zabbix-web导入mongodb模板**
<ul>
<li>配置-模板-导入模板；</li>
<li>选择<code>./master/mongodb/zbx_export_templates.xml</code>模板文件，并导入；</li>
<li>接下来便可以在 templates中看到&quot;Template App MongoDB&quot;这个模板；</li>
<li>可将此模板链接到某个主机上监控，并到最新数据里查看相关MongoDB信息；</li>
<li>如果相对此模板就行修改，可编辑zbx_export_templates.xml文件。</li>
</ul>
<br>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/zabbix_web_import_mongodb1.png"
        data-srcset="/images/Zabbix/zabbix_web_import_mongodb1.png, /images/Zabbix/zabbix_web_import_mongodb1.png 1.5x, /images/Zabbix/zabbix_web_import_mongodb1.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/zabbix_web_import_mongodb1.png"
        title="导入mongodb模板" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/zabbix_web_import_mongodb2.png"
        data-srcset="/images/Zabbix/zabbix_web_import_mongodb2.png, /images/Zabbix/zabbix_web_import_mongodb2.png 1.5x, /images/Zabbix/zabbix_web_import_mongodb2.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/zabbix_web_import_mongodb2.png"
        title="选择导入文件" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/zabbix_web_import_mongodb3.png"
        data-srcset="/images/Zabbix/zabbix_web_import_mongodb3.png, /images/Zabbix/zabbix_web_import_mongodb3.png 1.5x, /images/Zabbix/zabbix_web_import_mongodb3.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/zabbix_web_import_mongodb3.png"
        title="查看MongoDB模板" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/zabbix_web_import_mongodb4.png"
        data-srcset="/images/Zabbix/zabbix_web_import_mongodb4.png, /images/Zabbix/zabbix_web_import_mongodb4.png 1.5x, /images/Zabbix/zabbix_web_import_mongodb4.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/zabbix_web_import_mongodb4.png"
        title="在主机中关联MongoDB模板" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/zabbix_web_import_mongodb5.png"
        data-srcset="/images/Zabbix/zabbix_web_import_mongodb5.png, /images/Zabbix/zabbix_web_import_mongodb5.png 1.5x, /images/Zabbix/zabbix_web_import_mongodb5.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/zabbix_web_import_mongodb5.png"
        title="查看最新MongoDb数据" /></p>
<br/>
<h3 id="监控一台主机上的额外mongod实例">监控一台主机上的额外mongod实例</h3>
<p>由于可能一台主机上运行的mongod实例不止一个，所以我们需要修改一下前面下载的配置文件，用以监控其它端口的mongod实例。</p>
<ul>
<li>此处假设默认的mongod实例运行在27017端口上</li>
<li>另外还有一个mongod实例运行在27018端口上</li>
<li>此处假设我们已经完成了前面对27017mongodb的监控了</li>
</ul>
<p>操作：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">cd</span> /etc/zabbix
cp mongodb.sh mongodb_27018.sh

vim ./mongodb_27018.sh
<span class="c1">#配置监控的mongodb账号和端口</span>

<span class="nv">DB_HOST</span><span class="o">=</span>127.0.0.1
<span class="nv">DB_PORT</span><span class="o">=</span><span class="m">27018</span>
<span class="nv">DB_USERNAME</span><span class="o">=</span>zabbix
<span class="nv">DB_PASSWORD</span><span class="o">=</span>zabbix

<span class="c1">#现在就有了提取27017/27018两个mongodb实例的脚本</span>
<span class="c1">#mongodb.sh</span>
<span class="c1">#mongodb_27018.sh</span>



<span class="nb">cd</span> ./zabbxi-agentd.d

vim userparameter_mongodb.conf
<span class="c1">#在默认的27017下面添加一行提取mongodb_27018信息的脚本</span>

<span class="nv">UserParameter</span><span class="o">=</span>mongodb.status<span class="o">[</span>*<span class="o">]</span>,/etc/zabbix/mongodb.sh <span class="nv">$1</span> <span class="nv">$2</span> <span class="nv">$3</span> <span class="nv">$4</span> <span class="nv">$5</span>
<span class="nv">UserParameter</span><span class="o">=</span>mongodb_27018.status<span class="o">[</span>*<span class="o">]</span>,/etc/zabbix/mongodb_27018.sh <span class="nv">$1</span> <span class="nv">$2</span> <span class="nv">$3</span> <span class="nv">$4</span> <span class="nv">$5</span>

<span class="c1">#现在zabbix-server端就可以同时获取27017/27018两个mongodb实例的信息</span>
<span class="c1">#但是Web界面还不能直接显示出来，因为27018的键值和默认不相同</span>
<span class="c1">#没错，就是上面我们修改的 mongodb_27018.status[*]</span>
</code></pre></td></tr></table>
</div>
</div><br>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/mongodb_27018.png"
        data-srcset="/images/Zabbix/mongodb_27018.png, /images/Zabbix/mongodb_27018.png 1.5x, /images/Zabbix/mongodb_27018.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/mongodb_27018.png"
        title="mongodb_27018.sh" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/mongodb_27018_02.png"
        data-srcset="/images/Zabbix/mongodb_27018_02.png, /images/Zabbix/mongodb_27018_02.png 1.5x, /images/Zabbix/mongodb_27018_02.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/mongodb_27018_02.png"
        title="mongodb_27018.sh" /></p>
<br>
<p><strong>接下来要在Zabbix-Web端配置监控项用以提取信息</strong></p>
<p>我们先找到一个默认的MongoDB自带的配置模板，如<code>MongoDB Connections current</code>，点进去查看它的键值对为<code>mongodb.status[connections,current]</code></p>
<p>因此我们只需要修改为我们配置文件里面的<code>mongodb_27018.status[*]</code>就可以了。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/mongodb_27018_03.png"
        data-srcset="/images/Zabbix/mongodb_27018_03.png, /images/Zabbix/mongodb_27018_03.png 1.5x, /images/Zabbix/mongodb_27018_03.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/mongodb_27018_03.png"
        title="mongodb_27018.sh" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/mongodb_27018_04.png"
        data-srcset="/images/Zabbix/mongodb_27018_04.png, /images/Zabbix/mongodb_27018_04.png 1.5x, /images/Zabbix/mongodb_27018_04.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/mongodb_27018_04.png"
        title="mongodb_27018.sh" /></p>
<br>
<p>其余个监控项以此类推，我觉得其他服务也应该可以如此。</p>
<p><strong>你也可以对此建立一个单独的模板，如MongoDB_27108 templates。在此监控模板下创建上面的监控项。这样就可以对所有主机生效了。也可以批量化操作，更方便一些。</strong></p>
<p>下面是我的参考<strong>Template App MongoDB</strong>模板建立的<strong>Template App MongoDB_27018</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/mongodb_27018_05.png"
        data-srcset="/images/Zabbix/mongodb_27018_05.png, /images/Zabbix/mongodb_27018_05.png 1.5x, /images/Zabbix/mongodb_27018_05.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/mongodb_27018_05.png"
        title="mongodb_27018.sh" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/mongodb_27018_06.png"
        data-srcset="/images/Zabbix/mongodb_27018_06.png, /images/Zabbix/mongodb_27018_06.png 1.5x, /images/Zabbix/mongodb_27018_06.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/mongodb_27018_06.png"
        title="mongodb_27018.sh" /></p>
<br/>
<br>
<h2 id="监控php-fpm">监控PHP-FPM</h2>
<p>同样使用上面大神的模板。</p>
<p>步骤和监控MongoDB类似：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1">#进入下载的文件目录</span>
<span class="nb">cd</span> ./zabbix-master/php-fpm
cp ./php-fpm.xml.sh /etc/zabbix
chmod a+x /etc/zabbix/php-fpm.xml.sh
vim /etc/zabbix/php-fpm.xml.sh

<span class="c1">#如果这三个参数修改了，请修改</span>
<span class="c1">#因为是使用culr，所以请允许此IP能够访问此页面</span>
<span class="c1">#另外还要Nginx允许Server-IP访问哦，不然无法读取数据</span>
<span class="c1">#我测试的时候用IP无法获取数据，所以用的域名</span>
<span class="c1">#如果没做域名解析，请加本地hosts</span>
<span class="c1">#php-fpm_status使用我修改的</span>

<span class="nv">HOST</span><span class="o">=</span><span class="s2">&#34;localhost&#34;</span>
<span class="nv">PORT</span><span class="o">=</span><span class="s2">&#34;80&#34;</span>
<span class="c1">#status=&#34;status&#34;</span>
<span class="nv">status</span><span class="o">=</span><span class="s2">&#34;php-fpm_status&#34;</span>






cp ./userparameter_php-fpm.conf /etc/zabbix/zabbix_agent.d/
<span class="c1">#当然也可以把这个用户自定义参数写入zabbix_agent.conf</span>
<span class="c1">#修改自定义参数里面的文件位置</span>
vim /etc/zabbix/zabbix_agent.d/userparameter_php-fpm.conf

<span class="nv">UserParameter</span><span class="o">=</span>php-fpm.status<span class="o">[</span>*<span class="o">]</span>,/etc/zabbix/php-fpm.xml.sh <span class="nv">$1</span>




<span class="c1">#php-fpm，nginx的状态必须用Nginx展现，Zabbix-Server是使用curl提取状态页面的信息</span>
vim /etc/nginx/conf.d/zabbix.conf

server <span class="o">{</span>
	listen 80<span class="p">;</span>
    server_name zabbix.me localhost<span class="p">;</span>
<span class="c1">#如果localhost与其他配置文件冲突，那就用IP</span>
<span class="c1">#server_name zabbix.me 127.0.0.1 Private-IP Public-IP;</span>
    root /usr/share/zabbix<span class="p">;</span>

    access_log  /var/log/nginx/zabbix.access.log  main<span class="p">;</span>

<span class="c1">#allow无法使用localhost，所有内外网要分开写</span>
	allow 127.0.0.1<span class="p">;</span>
	allow Private-IP<span class="p">;</span>
	allow Public-IP<span class="p">;</span>
	allow Zabbix-Server-IP<span class="p">;</span>
	allow Remote-View-IP<span class="p">;</span>
	deny all<span class="p">;</span>

    location / <span class="o">{</span>
    	<span class="k">if</span> <span class="o">(</span>!-f <span class="nv">$request_filename</span><span class="o">)</span> <span class="o">{</span>
			rewrite ^<span class="o">([</span>^<span class="se">\?</span><span class="o">]</span>+<span class="o">)</span>$ /index.php?1<span class="o">=</span><span class="nv">$1</span> last<span class="p">;</span>
        <span class="o">}</span>
    <span class="o">}</span>


<span class="c1">#Nignx_Status</span>
    location /nginx_status <span class="o">{</span>
        stub_status on<span class="p">;</span>
        <span class="c1">#开启nginx自带的状态检查功能</span>
        access_log off<span class="p">;</span>
    <span class="o">}</span>


<span class="c1">#php-fpm_Status</span>
<span class="c1">#php-fpm的默认状态页面是/status,/ping。我修改了一下。</span>
    location ~ ^/php-fpm_<span class="o">(</span>status<span class="p">|</span>ping<span class="o">)</span>$ <span class="o">{</span>
    	access_log off<span class="p">;</span>
        fastcgi_pass 127.0.0.1:9000<span class="p">;</span>
        fastcgi_index index.php<span class="p">;</span>
        fastcgi_param SCRIPT_FILENAME <span class="nv">$document_root</span>/<span class="nv">$fastcgi_script_name</span><span class="p">;</span>
        include fastcgi_params<span class="p">;</span>
    <span class="o">}</span>


    location ~ <span class="se">\.</span>php$ <span class="o">{</span>
    	root /usr/share/zabbix<span class="p">;</span>
        fastcgi_pass 127.0.0.1:9000<span class="p">;</span>
        fastcgi_index index.php<span class="p">;</span>
        fastcgi_param SCRIPT_FILENAME <span class="nv">$document_root</span>/<span class="nv">$fastcgi_script_name</span><span class="p">;</span>
        include fastcgi_params<span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/zabbix-master_php-fpm.png"
        data-srcset="/images/Zabbix/zabbix-master_php-fpm.png, /images/Zabbix/zabbix-master_php-fpm.png 1.5x, /images/Zabbix/zabbix-master_php-fpm.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/zabbix-master_php-fpm.png"
        title="监控php-fpm" /></p>
<br/>
<p><strong>php-fpm状态页面的配置文件</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">vim /etc/php-fpm.d/www.conf

<span class="c1">#说明和用法如下，我做简单修改</span>
<span class="c1">#修改默认值</span>
<span class="p">;</span>pm.status_path <span class="o">=</span> /status
pm.status_path <span class="o">=</span> /php-fpm_status

<span class="p">;</span>ping.path <span class="o">=</span> /ping
ping.path <span class="o">=</span> /php-fpm_ping
<span class="p">;</span>ping.response <span class="o">=</span> pong
ping.response <span class="o">=</span> <span class="m">200</span>

<span class="c1">#用法</span>
zabbix.me/php-fpm_status
zabbix.me/php-fpm_ping

<span class="c1">#配置文件提供了格式化输出</span>
zabbix.me/php-fpm_status?html
zabbix.me/php-fpm_status?html<span class="p">&amp;</span>full



<span class="p">;</span> output syntax. Example:
<span class="p">;</span>   http://www.foo.bar/status
<span class="p">;</span>   http://www.foo.bar/status?json
<span class="p">;</span>   http://www.foo.bar/status?html
<span class="p">;</span>   http://www.foo.bar/status?xml
<span class="p">;</span>   http://www.foo.bar/status?full
<span class="p">;</span>   http://www.foo.bar/status?json<span class="p">&amp;</span>full
<span class="p">;</span>   http://www.foo.bar/status?html<span class="p">&amp;</span>full
<span class="p">;</span>   http://www.foo.bar/status?xml<span class="p">&amp;</span>full


<span class="c1">#修改完毕后重启服务</span>
systemctl restart php-fpm nginx







<span class="c1">#具体看下面描述</span>
<span class="c1">##这下面是说明</span>

<span class="p">;</span> The URI to view the FPM status page. If this value is not set, no URI will be
<span class="p">;</span> recognized as a status page. It shows the following informations:
<span class="p">;</span>   pool                 - the name of the pool<span class="p">;</span>
<span class="p">;</span>   process manager      - static, dynamic or ondemand<span class="p">;</span>
<span class="p">;</span>   start <span class="nb">time</span>           - the date and <span class="nb">time</span> FPM has started<span class="p">;</span>
<span class="p">;</span>   start since          - number of seconds since FPM has started<span class="p">;</span>
<span class="p">;</span>   accepted conn        - the number of request accepted by the pool<span class="p">;</span>
<span class="p">;</span>   listen queue         - the number of request in the queue of pending
<span class="p">;</span>                          connections <span class="o">(</span>see backlog in listen<span class="o">(</span>2<span class="o">))</span><span class="p">;</span>
<span class="p">;</span>   max listen queue     - the maximum number of requests in the queue
<span class="p">;</span>                          of pending connections since FPM has started<span class="p">;</span>
<span class="p">;</span>   listen queue len     - the size of the socket queue of pending connections<span class="p">;</span>
<span class="p">;</span>   idle processes       - the number of idle processes<span class="p">;</span>
<span class="p">;</span>   active processes     - the number of active processes<span class="p">;</span>
<span class="p">;</span>   total processes      - the number of idle + active processes<span class="p">;</span>
<span class="p">;</span>   max active processes - the maximum number of active processes since FPM
<span class="p">;</span>                          has started<span class="p">;</span>
<span class="p">;</span>   max children reached - number of times, the process limit has been reached,
<span class="p">;</span>                          when pm tries to start more children <span class="o">(</span>works only <span class="k">for</span>
<span class="p">;</span>                          pm <span class="s1">&#39;dynamic&#39;</span> and <span class="s1">&#39;ondemand&#39;</span><span class="o">)</span><span class="p">;</span>
<span class="p">;</span> Value are updated in real time.
<span class="p">;</span> Example output:
<span class="p">;</span>   pool:                 www
<span class="p">;</span>   process manager:      static
<span class="p">;</span>   start time:           01/Jul/2011:17:53:49 +0200
<span class="p">;</span>   start since:          <span class="m">62636</span>
<span class="p">;</span>   accepted conn:        <span class="m">190460</span>
<span class="p">;</span>   listen queue:         <span class="m">0</span>
<span class="p">;</span>   max listen queue:     <span class="m">1</span>
<span class="p">;</span>   listen queue len:     <span class="m">42</span>
<span class="p">;</span>   idle processes:       <span class="m">4</span>
<span class="p">;</span>   active processes:     <span class="m">11</span>
<span class="p">;</span>   total processes:      <span class="m">15</span>
<span class="p">;</span>   max active processes: <span class="m">12</span>
<span class="p">;</span>   max children reached: <span class="m">0</span>
<span class="p">;</span>
<span class="p">;</span> By default the status page output is formatted as text/plain. Passing either
<span class="p">;</span> <span class="s1">&#39;html&#39;</span>, <span class="s1">&#39;xml&#39;</span> or <span class="s1">&#39;json&#39;</span> in the query string will <span class="k">return</span> the corresponding
<span class="p">;</span> output syntax. Example:
<span class="p">;</span>   http://www.foo.bar/status
<span class="p">;</span>   http://www.foo.bar/status?json
<span class="p">;</span>   http://www.foo.bar/status?html
<span class="p">;</span>   http://www.foo.bar/status?xml
<span class="p">;</span>
<span class="p">;</span> By default the status page only outputs short status. Passing <span class="s1">&#39;full&#39;</span> in the
<span class="p">;</span> query string will also <span class="k">return</span> status <span class="k">for</span> each pool process.
<span class="p">;</span> Example:
<span class="p">;</span>   http://www.foo.bar/status?full
<span class="p">;</span>   http://www.foo.bar/status?json<span class="p">&amp;</span>full
<span class="p">;</span>   http://www.foo.bar/status?html<span class="p">&amp;</span>full
<span class="p">;</span>   http://www.foo.bar/status?xml<span class="p">&amp;</span>full
<span class="p">;</span> The Full status returns <span class="k">for</span> each process:
<span class="p">;</span>   pid                  - the PID of the process<span class="p">;</span>
<span class="p">;</span>   state                - the state of the process <span class="o">(</span>Idle, Running, ...<span class="o">)</span><span class="p">;</span>
<span class="p">;</span>   start <span class="nb">time</span>           - the date and <span class="nb">time</span> the process has started<span class="p">;</span>
<span class="p">;</span>   start since          - the number of seconds since the process has started<span class="p">;</span>
<span class="p">;</span>   requests             - the number of requests the process has served<span class="p">;</span>
<span class="p">;</span>   request duration     - the duration in µs of the requests<span class="p">;</span>
<span class="p">;</span>   request method       - the request method <span class="o">(</span>GET, POST, ...<span class="o">)</span><span class="p">;</span>
<span class="p">;</span>   request URI          - the request URI with the query string<span class="p">;</span>
<span class="p">;</span>   content length       - the content length of the request <span class="o">(</span>only with POST<span class="o">)</span><span class="p">;</span>
<span class="p">;</span>   user                 - the user <span class="o">(</span>PHP_AUTH_USER<span class="o">)</span> <span class="o">(</span>or <span class="s1">&#39;-&#39;</span> <span class="k">if</span> not <span class="nb">set</span><span class="o">)</span><span class="p">;</span>
<span class="p">;</span>   script               - the main script called <span class="o">(</span>or <span class="s1">&#39;-&#39;</span> <span class="k">if</span> not <span class="nb">set</span><span class="o">)</span><span class="p">;</span>
<span class="p">;</span>   last request cpu     - the %cpu the last request consumed
<span class="p">;</span>                          it<span class="s1">&#39;s always 0 if the process is not in Idle state
</span><span class="s1">;                          because CPU calculation is done when the request
</span><span class="s1">;                          processing has terminated;
</span><span class="s1">;   last request memory  - the max amount of memory the last request consumed
</span><span class="s1">;                          it&#39;</span>s always <span class="m">0</span> <span class="k">if</span> the process is not in Idle state
<span class="p">;</span>                          because memory calculation is <span class="k">done</span> when the request
<span class="p">;</span>                          processing has terminated<span class="p">;</span>
<span class="p">;</span> If the process is in Idle state, <span class="k">then</span> informations are related to the
<span class="p">;</span> last request the process has served. Otherwise informations are related to
<span class="p">;</span> the current request being served.
<span class="p">;</span> Example output:
<span class="p">;</span>   ************************
<span class="p">;</span>   pid:                  <span class="m">31330</span>
<span class="p">;</span>   state:                Running
<span class="p">;</span>   start time:           01/Jul/2011:17:53:49 +0200
<span class="p">;</span>   start since:          <span class="m">63087</span>
<span class="p">;</span>   requests:             <span class="m">12808</span>
<span class="p">;</span>   request duration:     <span class="m">1250261</span>
<span class="p">;</span>   request method:       GET
<span class="p">;</span>   request URI:          /test_mem.php?N<span class="o">=</span><span class="m">10000</span>
<span class="p">;</span>   content length:       <span class="m">0</span>
<span class="p">;</span>   user:                 -
<span class="p">;</span>   script:               /home/fat/web/docs/php/test_mem.php
<span class="p">;</span>   last request cpu:     0.00
<span class="p">;</span>   last request memory:  <span class="m">0</span>
<span class="p">;</span>
<span class="p">;</span> Note: There is a real-time FPM status monitoring sample web page available
<span class="p">;</span>       It<span class="err">&#39;</span>s available in: @EXPANDED_DATADIR@/fpm/status.html
<span class="p">;</span>
<span class="p">;</span> Note: The value must start with a leading slash <span class="o">(</span>/<span class="o">)</span>. The value can be
<span class="p">;</span>       anything, but it may not be a good idea to use the .php extension or it
<span class="p">;</span>       may conflict with a real PHP file.
<span class="p">;</span> Default Value: not <span class="nb">set</span>
<span class="p">;</span>pm.status_path <span class="o">=</span> /status
pm.status_path <span class="o">=</span> /php-fpm_status

<span class="p">;</span> The ping URI to call the monitoring page of FPM. If this value is not set, no
<span class="p">;</span> URI will be recognized as a ping page. This could be used to <span class="nb">test</span> from outside
<span class="p">;</span> that FPM is alive and responding, or to
<span class="p">;</span> - create a graph of FPM availability <span class="o">(</span>rrd or such<span class="o">)</span><span class="p">;</span>
<span class="p">;</span> - remove a server from a group <span class="k">if</span> it is not responding <span class="o">(</span>load balancing<span class="o">)</span><span class="p">;</span>
<span class="p">;</span> - trigger alerts <span class="k">for</span> the operating team <span class="o">(</span>24/7<span class="o">)</span>.
<span class="p">;</span> Note: The value must start with a leading slash <span class="o">(</span>/<span class="o">)</span>. The value can be
<span class="p">;</span>       anything, but it may not be a good idea to use the .php extension or it
<span class="p">;</span>       may conflict with a real PHP file.
<span class="p">;</span> Default Value: not <span class="nb">set</span>
<span class="p">;</span>ping.path <span class="o">=</span> /ping
ping.path <span class="o">=</span> /php-fpm_ping

<span class="p">;</span> This directive may be used to customize the response of a ping request. The
<span class="p">;</span> response is formatted as text/plain with a <span class="m">200</span> response code.
<span class="p">;</span> Default Value: pong
<span class="p">;</span>ping.response <span class="o">=</span> pong
ping.response <span class="o">=</span> <span class="m">200</span>
</code></pre></td></tr></table>
</div>
</div><br/>
<p>效果图：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/zabbix-master_php-fpm2.png"
        data-srcset="/images/Zabbix/zabbix-master_php-fpm2.png, /images/Zabbix/zabbix-master_php-fpm2.png 1.5x, /images/Zabbix/zabbix-master_php-fpm2.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/zabbix-master_php-fpm2.png"
        title="将php-fpm状态展现在Nginx上" /></p>
<br>
<p>展现的话是在Agent端的Nginx上，这个更直观一些。
而Zabbix-Server就是通过<code>curl -s zabbix.me</code>来获取数据的，并通过对数据的提取来返回给Zabbix-Server。
所以收集php-fpm，nginx的信息状态，都是基于这个页面的。</p>
<p>现在导入PHP-FPM模板，导入操作同MongoDB。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">#就是这个文件
zbx_export_templates.xml
</code></pre></td></tr></table>
</div>
</div><p>导入模板后，直接链接模板就可以啦。
然后就可以使用了。</p>
<br/>
<br/>
<h2 id="监控nginx">监控Nginx</h2>
<p>Zabbix是通过<code>stub_status</code>模块实现对Nginx的监控。
Nginx的ngx_http_stub_status_module模块提供了基本的Nginx状态信息，源码安装的话需要加上–with-http_stub_status_module编译参数，如果是epel源yum安装的话，已经默认启用该模块。</p>
<p>在Nginx配置文件中加入如下配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">location /nginx_status <span class="o">{</span>
	allow IP<span class="p">;</span>
	deny all<span class="p">;</span>
	stub_status on<span class="p">;</span>
    access_log off<span class="p">;</span>
<span class="o">}</span>



<span class="c1">#栗子</span>
Active connections: <span class="m">14</span>
server accepts handled requests
 <span class="m">22889</span> <span class="m">22889</span> <span class="m">72510</span>
Reading: <span class="m">0</span> Writing: <span class="m">2</span> Waiting: <span class="m">12</span>
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/nginx_status.png"
        data-srcset="/images/Zabbix/nginx_status.png, /images/Zabbix/nginx_status.png 1.5x, /images/Zabbix/nginx_status.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/nginx_status.png"
        title="nginx_status栗子" /></p>
<br/>
<p><strong>一些状态信息</strong></p>
<ul>
<li>
<p>Active connections
当前active client的连接数，包括<code>Wating</code></p>
</li>
<li>
<p>accepts
接受的客户端连接总数</p>
</li>
<li>
<p>handled
已处理的连接总数。通常，handled与accepts相同，除非已达到了资源限制(如worker_connections限制)</p>
</li>
<li>
<p>requests
客户端请求总数</p>
</li>
<li>
<p>Reading
当前nginx正在读取request header的连接数</p>
</li>
<li>
<p>Writing
当前Nginx将reponse写回客户端的连接数</p>
</li>
<li>
<p>Waiting
当前等待请求的空闲客户端的连接数</p>
</li>
</ul>
<br>
<p>上面的结果还可通过命令来查看</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">netstat -n | awk &#39;/^tcp/ {++S[$NF]} END {for(a in S) print a,S[a]}&#39;
</code></pre></td></tr></table>
</div>
</div><br>
<p>以上数据是通过Web端查看。
但，我们需要把数据收集到Zabbix-Server。还需要使用之前下载同MongoDB，php-fpm一起的那个包。</p>
<p><strong>操作，基本还是类似MongoDB，php-fpm。只是个别参数需要修改一下。</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">cd ./zabbix-master/nginx/
cp ./nginx.sh /etc/zabbix/
chmod a+x /etc/zabbix/nginx.sh

cp ./userparameter_nginx.conf /etc/zabbix/zabbix_agentd.d


vim /etc/zabbix/nginx.sh

#HOST=&#34;localhost&#34;
PORT=&#34;80&#34;
#stub_status=stub_status
stub_status=nginx_status



vim /etc/zabbix/zabbix_agentd.d/userparameter_nginx.conf

#修改成脚本对应的位置
UserParameter=nginx.status[*],/etc/zabbix/nginx.sh $1
</code></pre></td></tr></table>
</div>
</div><p>现在想以前一样导入模板。
然后在链接模板就可以了。</p>
<br>
<br/>
<h2 id="监控redis">监控Redis</h2>
<p>监控Redis，也是把包里面对应的文件复制过去就行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">cd</span> ./zabbix-master/redis
cp ./userparameter_redis.conf /etc/zabbix/zabbix_agentd.d/


<span class="c1">#如果redis设置有密码，请加上密码</span>
<span class="c1">#如果是不同的端口，请修改</span>
<span class="nv">UserParameter</span><span class="o">=</span>redis.local<span class="o">[</span>*<span class="o">]</span>,redis-cli -h 127.0.0.1 -p <span class="m">6379</span> info<span class="p">|</span>grep <span class="nv">$1</span><span class="p">|</span>grep -v _human<span class="p">|</span>cut -d : -f2
<span class="c1">#UserParameter=redis.local[*],redis-cli -h 127.0.0.1 -p 6379 -a Password info|grep $1|grep -v _human|cut -d : -f2</span>
<span class="nv">UserParameter</span><span class="o">=</span>redis.status<span class="o">[</span>*<span class="o">]</span>,redis-cli -h <span class="nv">$1</span> -p <span class="nv">$2</span> -a Password info<span class="p">|</span>grep <span class="nv">$3</span><span class="p">|</span>grep -v _human<span class="p">|</span>cut -d : -f2
<span class="nv">UserParameter</span><span class="o">=</span>redis.proc,pidof redis-server <span class="p">|</span> wc -l



<span class="c1">#重启服务</span>
systemctl restart redis
</code></pre></td></tr></table>
</div>
</div><p>导入模板，链接主机，OK。</p>
<br/>
<hr>
<br/>
<h1 id="系统监控">系统监控</h1>
<br>
<h2 id="cpu">CPU</h2>
<p>CPU的性能状态信息：</p>
<p>简写 | 描述 | 说明</p>
<ul>
<li>| - | -
us | user cpu tim | 用户使用CPU时间
sy | system cpu time | 系统使用CPU时间
id | idle cpu time | CPU的空闲时间
wa | io wait cpu time | CPU等待IO时间
ni | user nice cpu time | 用nice调整进程优先级的CPU时间
st | steal time | 虚拟机偷取的CPU时间比，被强制等待虚拟CPU的时间
si | softirq time | 系统处理软件中断所花费的CPU时间
hi | hard time | 系统硬中断所花费的CPU时间
interrupt | 中断 | 被处理过的中断数
cs | Context switches | 上下文切换
ql | processor queue length | 队列长度
processor load | processor load |  处理器负载，几核乘以几</li>
</ul>
<br/>
<h3 id="tips">Tips</h3>
<ul>
<li>当我们要监控并报警CPU使用率时，我们可以反过来用CPU空闲时间来定义</li>
<li>cpu idle tiem%  + cpu usage time% = 1</li>
<li>(CPU usage time% gt 80%) == (CPU idel time% lt 20%)</li>
<li>(CPU usage time% gt 90%) == (CPU idel time% &lt; 10%)</li>
<li>所以监控CPU使用率就可以监控CPU空闲时间，并依据这个报警</li>
</ul>
<br>
<br/>
<h2 id="内存">内存</h2>
<p>Zabbix中自带的Linux OS模板提供了<code>Total memory</code>和<code>Available memory</code>选项，这两者直接用模板就可以了。
但没有提供内存使用率的选项，因此需要我们自定义。</p>
<ul>
<li>内存使用率 = 可用内存 / 总内存</li>
<li>ast(vm.memory.size[available])/last(vm.memory.size[total])</li>
</ul>
<h3 id="自定义内存使用率">自定义内存使用率</h3>
<p>我们只需要在Linux OS模板下配置内存使用率，就可以一劳永逸。</p>
<ol>
<li>配置(Configuration)</li>
<li>模板(Templates)</li>
<li>OS Linux模板的监控项(Items)</li>
<li>创建监控项</li>
<li>监控项名称: Available memory percent</li>
<li>类型： 可计算的</li>
<li>键值： vm.memory.size[percent]</li>
<li>公式： 100*last(vm.memory.size[available])/last(vm.memory.size[total])</li>
<li>记得将其加入Memory应用集，这样便于查找和管理</li>
<li>可加入单位： %</li>
</ol>
<br/>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/custom_memorypercent.png"
        data-srcset="/images/Zabbix/custom_memorypercent.png, /images/Zabbix/custom_memorypercent.png 1.5x, /images/Zabbix/custom_memorypercent.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/custom_memorypercent.png"
        title="自定义可用内存率" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/custom_memorypercent2.png"
        data-srcset="/images/Zabbix/custom_memorypercent2.png, /images/Zabbix/custom_memorypercent2.png 1.5x, /images/Zabbix/custom_memorypercent2.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/custom_memorypercent2.png"
        title="自定义可用内存率" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/custom_memorypercent3.png"
        data-srcset="/images/Zabbix/custom_memorypercent3.png, /images/Zabbix/custom_memorypercent3.png 1.5x, /images/Zabbix/custom_memorypercent3.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/custom_memorypercent3.png"
        title="效果图" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/custom_memorypercent4.png"
        data-srcset="/images/Zabbix/custom_memorypercent4.png, /images/Zabbix/custom_memorypercent4.png 1.5x, /images/Zabbix/custom_memorypercent4.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/custom_memorypercent4.png"
        title="效果图" /></p>
<br>
<h3 id="添加触发器">添加触发器</h3>
<ol>
<li>配置</li>
<li>模板</li>
<li>OS Linux模板</li>
<li>触发器</li>
<li>创建触发器，当可用内存率在三分钟内的平均值小于20%时报警</li>
<li>名字：Available memory percent lt 20% on {HOST.NAME}</li>
<li>严重性：一般严重</li>
<li>表达式： {Template OS Linux:vm.memory.size[percent].avg(3)}&lt;20</li>
</ol>
<br/>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/custom_memorypercent5.png"
        data-srcset="/images/Zabbix/custom_memorypercent5.png, /images/Zabbix/custom_memorypercent5.png 1.5x, /images/Zabbix/custom_memorypercent5.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/custom_memorypercent5.png"
        title="自定义可用内存率报警" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/custom_memorypercent6.png"
        data-srcset="/images/Zabbix/custom_memorypercent6.png, /images/Zabbix/custom_memorypercent6.png 1.5x, /images/Zabbix/custom_memorypercent6.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/custom_memorypercent6.png"
        title="效果图" /></p>
<br/>
<br/>
<h2 id="磁盘">磁盘</h2>
<p>由于Zabbix-Server自带的Linux OS模板中的filesystem的监控是一个自动发现规则，而在应用集中的filesystem是没有监控项的。所有对于磁盘的监控和触发要在自动发现规则中去定义。</p>
<br/>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/custom_disk1.png"
        data-srcset="/images/Zabbix/custom_disk1.png, /images/Zabbix/custom_disk1.png 1.5x, /images/Zabbix/custom_disk1.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/custom_disk1.png"
        title="监控项" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/custom_disk2.png"
        data-srcset="/images/Zabbix/custom_disk2.png, /images/Zabbix/custom_disk2.png 1.5x, /images/Zabbix/custom_disk2.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/custom_disk2.png"
        title="触发器" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/custom_disk3.png"
        data-srcset="/images/Zabbix/custom_disk3.png, /images/Zabbix/custom_disk3.png 1.5x, /images/Zabbix/custom_disk3.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/custom_disk3.png"
        title="触发器" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/custom_disk4.png"
        data-srcset="/images/Zabbix/custom_disk4.png, /images/Zabbix/custom_disk4.png 1.5x, /images/Zabbix/custom_disk4.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/custom_disk4.png"
        title="触发器" /></p>
<br>
<br/>
<h2 id="进程和端口">进程和端口</h2>
<p>Zabbix-Server自带有检测进程和端口的键值对。</p>
<h3 id="检测进程数">检测进程数</h3>
<p><code>proc.num[&lt;name&gt;,&lt;user&gt;,&lt;state&gt;,&lt;cmdline&gt;]</code></p>
<ul>
<li>name: 进程名；</li>
<li>user: 运行该进程的用户；</li>
<li>state:
<ol>
<li>run</li>
<li>sleep</li>
<li>zomb</li>
</ol>
</li>
<li>cmdline: ps -ef的最后那项，如/usr/bin/mongod -f /etc/mongod.conf</li>
</ul>
<p>现在Zabbix-Server端测试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1">#zabbix-get --host hostname --key proc.num[&lt;name&gt;,&lt;user&gt;,&lt;state&gt;,&lt;cmdline&gt;]</span>


<span class="c1">#检测mongd进程数量</span>
zabbix-get --host 192.168.1.11 --key proc.num<span class="o">[</span>mongod,,,<span class="o">]</span>

<span class="c1">#2，因为我开了两个mongd实例</span>


zabbix-get --host 192.168.1.11 --key proc.num<span class="o">[</span>mongod,root,,<span class="o">]</span>
<span class="c1">#1，只有一个是以root运行的，有一个是以mongod运行的</span>

</code></pre></td></tr></table>
</div>
</div><br>
<p>由于我们上面使用的MongoDB监控模板没有判断mongod进程存活与否的判断，此处我们在MongoDB模板中增加一个检查<code>mongod</code>进程的监控项，并创建对应的触发器。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/MongoDB/checkmongod.png"
        data-srcset="/images/MongoDB/checkmongod.png, /images/MongoDB/checkmongod.png 1.5x, /images/MongoDB/checkmongod.png 2x"
        data-sizes="auto"
        alt="/images/MongoDB/checkmongod.png"
        title="/images/MongoDB/checkmongod.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/MongoDB/checkmongod2.png"
        data-srcset="/images/MongoDB/checkmongod2.png, /images/MongoDB/checkmongod2.png 1.5x, /images/MongoDB/checkmongod2.png 2x"
        data-sizes="auto"
        alt="/images/MongoDB/checkmongod2.png"
        title="/images/MongoDB/checkmongod2.png" /></p>
<br>
<h3 id="端口">端口</h3>
<p><code>net.tcp.listen[port]</code>	检查 TCP 端口 是否处于侦听状态。返回 0 - 未侦听；1 - 正在侦听</p>
<p>此处我也用Mongod举例。我的两个mongod实例分别监听在27017,27018/tcp。</p>
<br>
<p>在Zabbix-Server端先测试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1">#net.tcp.listen[port]</span>

zabbix-get --host 192.168.1.11 --key net.tcp.listen<span class="o">[</span>27017<span class="o">]</span>
<span class="c1">#1</span>
zabbix-get --host 192.168.1.11 --key net.tcp.listen<span class="o">[</span>27018<span class="o">]</span>
<span class="c1">#1</span>
</code></pre></td></tr></table>
</div>
</div><p>在Web端创建监控项和触发器与上面类似。</p>
<br>
<hr>
<br/>
<h1 id="用户自定义参数user-parameter-1">用户自定义参数(user parameter)</h1>
<p>我也是参考了上述大神的脚本，进行参考而来。</p>
<p>由于公司需要监控大量的Web页面和API接口的状态，并通过页面判断相关key-value的正确性，用以判断状态。此处可能由模拟登录等操作，Zabbix自带的Web监控不太够用，所以此处自定义用户参数来实现。</p>
<p>此处，我叫公司开发人员帮忙将全部接口以及Web页面内容都生成到一个json文件里，如 <a href="http://zhang21.cn/test.json">http://zhang21.cn/test.json</a>。然后用<code>jq</code>命令解析json文件，里面key一一对应value，这样取值就很方便了。</p>
<br>
<br>
<h2 id="jq">jq</h2>
<p>jq 是一款命令行下处理 JSON 数据的工具。真的很好用！</p>
<p>jq官网：<a href="https://stedolan.github.io/jq/">https://stedolan.github.io/jq/</a>
GitHub: <a href="https://github.com/stedolan/jq">https://github.com/stedolan/jq</a></p>
<br/>
<p><strong>安装jq</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">yum install -y jq

</code></pre></td></tr></table>
</div>
</div><br>
<p><strong>使用jq</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">jq --help


<span class="c1">#查看所有键键值</span>
curl --silent http://zhang21.cn/test.json <span class="p">|</span> jq .


<span class="c1">###栗子</span>
<span class="o">{</span>
  <span class="s2">&#34;collapsectimes&#34;</span>: 130,
  <span class="s2">&#34;collapsectimes&#34;</span>: 0,
  <span class="s2">&#34;bootfailtimes&#34;</span>: 23,
  <span class="s2">&#34;failrate&#34;</span>: 0.3623,
  <span class="s2">&#34;bootrate&#34;</span>: 0.3324,
  <span class="s2">&#34;time&#34;</span>: <span class="s2">&#34;2018-01-25 15:03:30&#34;</span>,
  <span class="s2">&#34;db_error&#34;</span>: <span class="nb">false</span>
<span class="o">}</span>


<span class="c1">#查看某个键值</span>
curl --silent http://zhang21.cn/test.json <span class="p">|</span> jq <span class="s1">&#39;.time&#39;</span>
curl --silent http://zhang21.cn/test.json <span class="p">|</span> jq <span class="s1">&#39;.bootrate&#39;</span>

<span class="c1">###</span>
2018-01-25 15:03:30
0.3324


<span class="c1">#查看某个不存在的值，会返回null</span>
curl --silent http://zhang21.cn/test.json <span class="p">|</span> jq <span class="s1">&#39;.zhang&#39;</span>

<span class="c1">###</span>
null
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/jq01.png"
        data-srcset="/images/Zabbix/jq01.png, /images/Zabbix/jq01.png 1.5x, /images/Zabbix/jq01.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/jq01.png"
        title="/images/Zabbix/jq01.png" /></p>
<br>
<p><strong>json嵌套解析</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">cat test.json <span class="p">|</span> jq <span class="s1">&#39;.location.city&#39;</span>

<span class="c1">###</span>
<span class="s2">&#34;Chengdu&#34;</span>
</code></pre></td></tr></table>
</div>
</div><br>
<p><strong>json解析数组</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">cat test.json <span class="p">|</span> jq <span class="s1">&#39;.array[1].name&#39;</span>

<span class="c1">###</span>
<span class="s2">&#34;Zhang&#34;</span>
</code></pre></td></tr></table>
</div>
</div><br/>
<p><strong>内建函数</strong></p>
<p>jq还有一些内建函数，如<code>key</code>,<code>hss</code>。</p>
<p>key用来获取json中的key元素：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">curl --silent http://zhang21.cn/test.json <span class="p">|</span> jq <span class="s1">&#39;keys&#39;</span>

<span class="c1">###</span>
<span class="o">[</span>
	collapsectimes,
	collapsectimes,
	bootfailtimes,
	failrate,
	bootrate,
	time,
	db_error
<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><p>has用来判断是否存在某个key:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">curl --silent http://zhang21.cn/test.json <span class="p">|</span> jq <span class="s1">&#39;has(&#34;time&#34;)&#39;</span>

<span class="c1">###</span>
<span class="nb">true</span>
</code></pre></td></tr></table>
</div>
</div><br>
<h3 id="jq的select语句">jq的select语句</h3>
<p>使用select函数来完成jq的过滤操作。
jq的select语句太好了!</p>
<p>select 接受一个条件表达式作为参数。其输入可以是迭代器，或者和 map 函数配合使用来处理数组。当输入中的某个元素使 select 参数中的条件表达式结果为真时，则在结果中保留该元素，否则不保留该元素。</p>
<p>对json文件的值是数组的，根据数据里面的key在取值，厉害厉害。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">cat zhang.json

<span class="s2">&#34;array&#34;</span>: <span class="o">[</span>
<span class="o">{</span>
	<span class="s2">&#34;ip&#34;</span>: <span class="s2">&#34;192.168.1.11&#34;</span>,
	<span class="s2">&#34;loads&#34;</span>: <span class="m">1234</span>
<span class="o">}</span>,
<span class="o">{</span>
	<span class="s2">&#34;ip&#34;</span>: <span class="s2">&#34;192.168.1.22&#34;</span>,
    <span class="s2">&#34;loads&#34;</span>: <span class="m">567</span>
<span class="o">}</span>
<span class="o">]</span>



<span class="c1">####栗子</span>
cat /etc/zabbix/zhang.json <span class="p">|</span> jq <span class="s2">&#34;.array[] | select(.ip == \&#34;192.168.1.11\&#34;)&#34;</span>
<span class="o">{</span>
	<span class="s2">&#34;ip&#34;</span>: <span class="s2">&#34;192.168.1.11&#34;</span>,
	<span class="s2">&#34;loads&#34;</span>: <span class="m">1234</span>
<span class="o">}</span>

cat /etc/zabbix/zhang.json <span class="p">|</span> jq <span class="s2">&#34;.array[] | select(.ip == \&#34;192.168.1.11\&#34;).loads&#34;</span>
<span class="m">1234</span>

我们在自定义用户参数的时候便可以将ip作为参数传入
cat /etc/zabbix/zhang.json <span class="p">|</span> jq <span class="s2">&#34;.array[] | select(.ip == \&#34;</span><span class="nv">$1</span><span class="s2">\&#34;).loads&#34;</span>
</code></pre></td></tr></table>
</div>
</div><br>
<br/>
<h2 id="编写自定义参数和脚本">编写自定义参数和脚本</h2>
<p>将脚本放置于<code>/etc/zabbix</code>，可将自定义参数写入zabbix-agentd.conf文件，也可单独写入<code>/etc/zabbix/zabbix_agentd.d/</code>(推荐)，这样修改更方便。</p>
<br>
<h3 id="编写脚本文件">编写脚本文件</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">cd</span> /etc/zabbix

vim xbreport.sh


<span class="c1">##########</span>

<span class="c1"># Zabbix3.4</span>
<span class="c1"># Zhang21</span>
<span class="c1"># Thu Jan 25 15:20:44 CST 2018</span>

<span class="c1">###########</span>

<span class="nv">url</span><span class="o">=</span><span class="s2">&#34;http://zhang21.cn/test.json&#34;</span>

<span class="nv">JQ</span><span class="o">=</span><span class="sb">`</span>which jq<span class="sb">`</span>
<span class="nv">CURL</span><span class="o">=</span><span class="sb">`</span>which curl<span class="sb">`</span>


<span class="k">function</span> XBREPORT<span class="o">()</span> <span class="o">{</span>
        <span class="nv">$CURL</span> --silent <span class="nv">$url</span> <span class="p">|</span> <span class="nv">$JQ</span> <span class="s2">&#34;.</span><span class="nv">$1</span><span class="s2">&#34;</span>
<span class="o">}</span>


<span class="k">if</span> <span class="o">[</span> <span class="nv">$#</span> <span class="o">==</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> $<span class="s2">&#34;Usage </span><span class="nv">$0</span><span class="s2"> {browsercollapsectimes|servercollapsectimes|xiaobaibootfailtimes|terminaldesktopfailrate|competebootrate|db_error}&#34;</span>
        <span class="nb">exit</span>
<span class="k">else</span>
        XBREPORT <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span>
<span class="k">fi</span>

</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/jq02.png"
        data-srcset="/images/Zabbix/jq02.png, /images/Zabbix/jq02.png 1.5x, /images/Zabbix/jq02.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/jq02.png"
        title="/images/Zabbix/jq02.png" /></p>
<br/>
<h3 id="编写自定义参数文件">编写自定义参数文件</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">cd</span> /etc/zabbix/zabbix_agentd.d

vim userparameter_XBreport.conf


<span class="c1">##########</span>
<span class="c1"># Zabbix3.4</span>
<span class="c1"># Zhang21</span>
<span class="c1"># Thu Jan 25 15:45:19 CST 2018</span>
<span class="c1">##########</span>

<span class="nv">UserParameter</span><span class="o">=</span>XBreport<span class="o">[</span>*<span class="o">]</span>,/etc/zabbix/xbreport.sh <span class="nv">$1</span>
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/jq03.jpg"
        data-srcset="/images/Zabbix/jq03.jpg, /images/Zabbix/jq03.jpg 1.5x, /images/Zabbix/jq03.jpg 2x"
        data-sizes="auto"
        alt="/images/Zabbix/jq03.jpg"
        title="/images/Zabbix/jq03.jpg" /></p>
<br/>
<h3 id="测试自定义参数">测试自定义参数</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">zabbix_get --host host --key XBreport<span class="o">[</span>time<span class="o">]</span>

<span class="c1">###</span>
<span class="s2">&#34;2018-01-25 17:03:18&#34;</span>
</code></pre></td></tr></table>
</div>
</div><br>
<h3 id="自定义用户参数额外">自定义用户参数额外</h3>
<p>由于我的json文件key对应的value中内嵌有数组，所以我需要再提取数组内的值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">curl http://zhang21.cn/test.json | jq &#39;.array&#39;


###
[
  {
    &#34;ip&#34;: &#34;1.1.1.1&#34;,
    &#34;loads&#34;: 1051
  },
  {
    &#34;ip&#34;: &#34;2.2.2.2&#34;,
    &#34;loads&#34;: 356
  }
]


#array[],array[1],array[2],array[n]
#array[].ip, array[1].ip
#array[].loads, array[2].loads
</code></pre></td></tr></table>
</div>
</div><p>上面的数据中包含有zabbix无法解析的特殊符号，所以需要改变策略。</p>
<br>
<p>由于zabbix对UserParameter中包含**'&quot;`*?[]{}~$?&amp;;()&lt;&gt;|#@**这些特殊字符无法进行处理，此处有两种方法来解决。</p>
<ol>
<li>在<code>zabbix_agentd.conf</code>中开启参数<code>UnsafeUserParameters</code>，将其值设置为1</li>
<li>或者，使用多个变量<code>$1 $2 $3...</code>来解决我这个数组值的问题</li>
</ol>
<br>
<p>我是使用多个变量来解决我这个情况的。
看下脚本。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">cd /etc/zabbix

vim ./zhang.sh



url=&#39;http://www.zhang21.cn/test.json&#39;
JQ=`which jq`
CURL=`which curl`

function ZHANG() {
        $CURL --silent $url | $JQ &#34;.$1&#34;
}

if [ $# == 0 ]; then
        echo $&#34;Usage $0 {aaa|bbb|ccc|...}&#34;
        exit
elif [ $# ==1 ]; then
		ZHANG &#34;$1&#34;
elif [ $# == 2 ]; then
        ZHANG &#34;$1[$2]&#34;
else
        ZHANG &#34;$1[$2].$3&#34;
fi





cd /etc/zabbix/zabbix_agentd.d/userparameter_Zhang.conf

UserParameter=Zhangxx[*],/etc/zabbix/zhang.sh $1 $2 $3
</code></pre></td></tr></table>
</div>
</div><p>测试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">systemctl restart zabbix-agentd

zabbix_get --host host --key Zhangxx<span class="o">[</span>array<span class="o">]</span>
zabbix_get --host host --key Zhangxx<span class="o">[</span>array,0<span class="o">]</span>
zabbix_get --host host --key Zhangxx<span class="o">[</span>array,0,loads<span class="o">]</span>
zabbix_get --host host --key Zhangxx<span class="o">[</span>array,1,ip<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><br>
<p>测试正确能取到值的话，在Web端设置相对应的监控项。注意自己定义的<code>key</code>不要写错了。</p>
<p>数组的<code>key</code>栗子：</p>
<ul>
<li>Zhangxx[array]</li>
<li>Zhangxx[array,0]或Zhangxx[array,1]</li>
<li>Zhangxx[array,0,ip], Zhangxx[array,0,loads]</li>
</ul>
<br/>
<h3 id="在web端添加监控项">在Web端添加监控项</h3>
<p>由于这个参数是我们自定义的，所以在填写监控项key的时候需要我们手动填写自己定义的参数。
注意监控项的参数和信息类型。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/userparameter.png"
        data-srcset="/images/Zabbix/userparameter.png, /images/Zabbix/userparameter.png 1.5x, /images/Zabbix/userparameter.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/userparameter.png"
        title="/images/Zabbix/userparameter.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/userparameter02.png"
        data-srcset="/images/Zabbix/userparameter02.png, /images/Zabbix/userparameter02.png 1.5x, /images/Zabbix/userparameter02.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/userparameter02.png"
        title="/images/Zabbix/userparameter02.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/userparameter03.png"
        data-srcset="/images/Zabbix/userparameter03.png, /images/Zabbix/userparameter03.png 1.5x, /images/Zabbix/userparameter03.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/userparameter03.png"
        title="/images/Zabbix/userparameter03.png" /></p>
<br>
<p>这里我遇到一个问题，我自定义key的执行脚本在Web端报超时问题，无法取值。这是由于zabbix默认的脚本执行超时时间为3s，所以我们需要修改超时时间30s(最大值)。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">vim /etc/zabbix/zabbix_server.conf
vim /etc/zabbix/zabbix_agentd.conf
</code></pre></td></tr></table>
</div>
</div><br/>
<h3 id="设置触发器和报警">设置触发器和报警</h3>
<p>这个就根据你个人项目实际情况设置对于的触发器和报警。</p>
<br>
<hr>
<br/>
<h1 id="短信报警">短信报警</h1>
<h2 id="腾讯短信服务">腾讯短信服务</h2>
<p>由于公司使用的是腾讯企业邮箱，可以将邮箱直接与微信绑定，从而在微信中实时显示邮件消息，所以不用微信报警！</p>
<p>此处使用的腾讯短信SMS服务： <a href="https://cloud.tencent.com/product/sms">https://cloud.tencent.com/product/sms</a></p>
<ul>
<li>短信文档： <a href="https://cloud.tencent.com/document/product/382/13445">https://cloud.tencent.com/document/product/382/13445</a></li>
<li>API文档： <a href="https://cloud.tencent.com/document/product/382/13297">https://cloud.tencent.com/document/product/382/13297</a></li>
<li>SDK文档： <a href="https://cloud.tencent.com/document/product/382/5804">https://cloud.tencent.com/document/product/382/5804</a></li>
<li>Python SDK: <a href="https://cloud.tencent.com/document/product/382/11672">https://cloud.tencent.com/document/product/382/11672</a></li>
</ul>
<p>由于腾讯提供了程序SDK，所以我选择了linux自带的Python SDK。
这里面有详细的Python使用方法，做一些小修改就可以使用了。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/SDK.png"
        data-srcset="/images/Zabbix/SDK.png, /images/Zabbix/SDK.png 1.5x, /images/Zabbix/SDK.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/SDK.png"
        title="/images/Zabbix/SDK.png" /></p>
<br>
<br/>
<h2 id="配置">配置</h2>
<h3 id="获取python-sdk">获取Python SDK</h3>
<p>获取Python SDK</p>
<br>
<h3 id="申请sdk-appid和app-key">申请SDK AppID和App Key</h3>
<p>申请SDK AppID以及APP Key。</p>
<p>申请完毕后，效果如下：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/SDK02.png"
        data-srcset="/images/Zabbix/SDK02.png, /images/Zabbix/SDK02.png 1.5x, /images/Zabbix/SDK02.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/SDK02.png"
        title="/images/Zabbix/SDK02.png" /></p>
<br>
<h3 id="申请短信签名">申请短信签名</h3>
<p>下发短信必须携带短信签名。
短信签名需要上传公司证件进行认证，大概十分钟左右！</p>
<p>效果如下：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/SDK03.png"
        data-srcset="/images/Zabbix/SDK03.png, /images/Zabbix/SDK03.png 1.5x, /images/Zabbix/SDK03.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/SDK03.png"
        title="/images/Zabbix/SDK03.png" /></p>
<br>
<h3 id="申请短信模板">申请短信模板</h3>
<p>下发短信内容必须经过审核。
在此短信模板中，我们必须要定义相关变量<code>{n}</code>，其他都是不会变化的常量。此处我定义了五个变量，分别为了带入Zabbix中的宏：</p>
<ul>
<li>问题名，{TRIGGER.NAME}</li>
<li>主机名，{HOST.NAME}</li>
<li>事件事件，{EVENT.TIME}</li>
<li>事件日期，{EVENT.DATE}</li>
<li>URL，{TRIGGER.URL}</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/SDK04.png"
        data-srcset="/images/Zabbix/SDK04.png, /images/Zabbix/SDK04.png 1.5x, /images/Zabbix/SDK04.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/SDK04.png"
        title="/images/Zabbix/SDK04.png" /></p>
<br>
<h3 id="sdk配置">SDK配置</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">yum install -y eple-realse
yum install -y python-pip

pip install qcloudsms
</code></pre></td></tr></table>
</div>
</div><br/>
<h3 id="python代码配置">Python代码配置</h3>
<p>腾讯文档：<a href="https://cloud.tencent.com/document/product/382/11672">https://cloud.tencent.com/document/product/382/11672</a></p>
<p>由于我是向多人发送短信，所以做了小修改：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-py" data-lang="py"><span class="c1">#zabbix-server</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">zabbis</span><span class="o">/</span><span class="n">alartscripts</span>


<span class="n">vim</span> <span class="n">sendSms</span><span class="o">.</span><span class="n">py</span>





<span class="c1">#!/bin/python</span>
<span class="c1">#coding: utf-8</span>

<span class="kn">from</span> <span class="nn">qcloudsms_py</span> <span class="kn">import</span> <span class="n">SmsSingleSender</span>
<span class="kn">from</span> <span class="nn">qcloudsms_py.httpclient</span> <span class="kn">import</span> <span class="n">HTTPError</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="n">appid</span> <span class="o">=</span> <span class="n">App</span> <span class="n">ID</span>
<span class="n">appkey</span> <span class="o">=</span> <span class="n">App</span> <span class="n">Key</span>
<span class="n">phone_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;12345&#34;</span><span class="p">,</span> <span class="s2">&#34;1234567&#34;</span><span class="p">]</span>
<span class="c1">#params = [&#34;Problem&#34;, &#34;Hostname&#34;, &#34;Time&#34;, &#34;Date&#34;,&#34;Url&#34;]</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span>


<span class="n">msender</span> <span class="o">=</span> <span class="n">SmsSingleSender</span><span class="p">(</span><span class="n">appid</span><span class="p">,</span> <span class="n">appkey</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">phone_numbers</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">msender</span><span class="o">.</span><span class="n">send_with_param</span><span class="p">(</span><span class="mi">86</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="err">短信内容模板</span><span class="n">ID</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>要给sendSms.py加上可执行权限哈！<code>chmod a+x ./sendSms.py</code>。</p>
<br>
<p><code>sys.argv</code>变量是一个字符串的列表。特别地，<code>sys.argv</code>包含了命令行参数 的列表，即使用命令行传递给你的程序的参数。
使用Python的<code>sys.argv[n]</code>可以像shell一样将放在文件后的变量传入文件执行。此处对于在Zabbix-Web端将宏放在脚本后，作为变量传入，非常重要。</p>
<ul>
<li><code>sys.argv[0]</code>代表sendSms.py文件</li>
<li><code>sys.argv[1]</code>才代表第一个参数。</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/SDK05.jpg"
        data-srcset="/images/Zabbix/SDK05.jpg, /images/Zabbix/SDK05.jpg 1.5x, /images/Zabbix/SDK05.jpg 2x"
        data-sizes="auto"
        alt="/images/Zabbix/SDK05.jpg"
        title="/images/Zabbix/SDK05.jpg" /></p>
<br>
<br/>
<h2 id="zabbix-web端配置">Zabbix Web端配置</h2>
<p>配置-动作-创建动作-操作</p>
<p>注意事项：</p>
<ul>
<li>建议针对触发器示警度最高就行短信报警，其它交给Email</li>
<li>操作类型，选择远程命令</li>
<li>目标列表，选择当前主机</li>
<li>类型，自定义脚本</li>
<li>执行在，这个一定是放在Zabbix-Server上来执行哈</li>
<li>命令，文件名SendSms.py后面接的宏一定要加上<strong>双引号(&quot;&quot;)</strong></li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/SDK06.png"
        data-srcset="/images/Zabbix/SDK06.png, /images/Zabbix/SDK06.png 1.5x, /images/Zabbix/SDK06.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/SDK06.png"
        title="/images/Zabbix/SDK06.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/SDK07.png"
        data-srcset="/images/Zabbix/SDK07.png, /images/Zabbix/SDK07.png 1.5x, /images/Zabbix/SDK07.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/SDK07.png"
        title="/images/Zabbix/SDK07.png" /></p>
<p>最后根据不同的内容，设置不同的报警机制。后台的脚本也修改为对应的名称，修改里面对应的手机号码。</p>
<ul>
<li>首先根据不同报警设置不同的触发条件</li>
<li>运维组，SendSms_dev.py，修改运维对应的号码</li>
<li>开发组，SendSms_develop.py，修改对于的号码</li>
</ul>
<br>
<p>其实这个发送短信，就是在执行远程命令。</p>
<p>你命令里是发送短信就发送短信，你命令里是发送邮件就发送邮件。这个还是挺不错的。</p>
<br>
<hr>
<br/>
<h1 id="针对不同业务向不同人员报警">针对不同业务向不同人员报警</h1>
<p>有时候我们只需要关心我们自己那部分就可以了，没必要所有报警都发送给所有人，这样很不方便。</p>
<p>所以，我们可以根据业务相关，组别权限等，分别向不同的人报警不同的信息。</p>
<p>如下我的一个栗子图：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Zabbix/action.png"
        data-srcset="/images/Zabbix/action.png, /images/Zabbix/action.png 1.5x, /images/Zabbix/action.png 2x"
        data-sizes="auto"
        alt="/images/Zabbix/action.png"
        title="/images/Zabbix/action.png" /></p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2017-11-14</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/zabbix/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://zhang21.cn/zabbix/" data-title="Zabbix" data-hashtags="zabbix"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://zhang21.cn/zabbix/" data-title="Zabbix"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Reddit" data-sharer="reddit" data-url="https://zhang21.cn/zabbix/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://zhang21.cn/zabbix/" data-title="Zabbix"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.0.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://zhang21.cn/zabbix/" data-title="Zabbix"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/zabbix/">zabbix</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/git/" class="prev" rel="prev" title="Git"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Git</a>
            <a href="/fhs/" class="next" rel="next" title="Filesystem Hierarchy Standard">Filesystem Hierarchy Standard<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.83.1">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2017 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://zhang21.cn" target="_blank">Zhang21</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><script type="text/javascript" src="https://zhang21.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":20},"comment":{},"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"RZ22ZCTIDN","algoliaIndex":"hugo-index","algoliaSearchKey":"11ec277ef4d730e232eda9651548da78","highlightTag":"em","maxResultLength":20,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"twemoji":true};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
